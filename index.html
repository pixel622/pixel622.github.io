<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pokémon Amber: K&E Version</title>
    <style>
        :root {
            --pkm-blue: #3a86ff;
            --gba-text: #424242;
            --amber: #ffbf00;
        }
        body {
            margin: 0; background: #1a1a1a;
            color: white; font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; touch-action: none;
        }
        #game-container {
            position: relative; width: 100vw; max-width: 500px; height: 60vh;
            background: black; border: 4px solid #444; margin-top: 10px;
            overflow: hidden;
        }
        canvas { width: 100%; height: 100%; image-rendering: pixelated; }
        
        /* UI Elements */
        #textbox {
            position: absolute; bottom: 5px; left: 5px; right: 5px;
            height: 30%; background: #fff; border: 3px solid var(--gba-text);
            border-radius: 5px; padding: 10px; color: var(--gba-text);
            font-weight: bold; font-size: 14px; display: none; z-index: 10;
        }
        #joystick-zone {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        #starter-ui {
            position: absolute; top: 20%; left: 50%; transform: translateX(-50%);
            display: none; flex-direction: column; gap: 10px; z-index: 20;
        }
        .choice-btn {
            background: var(--amber); border: 2px solid #fff; padding: 10px;
            font-weight: bold; border-radius: 5px; cursor: pointer;
        }
        #controls {
            width: 100%; max-width: 500px; height: 35vh;
            display: flex; justify-content: space-around; align-items: center;
        }
        .action-circle {
            width: 70px; height: 70px; background: #cc0000;
            border-radius: 50%; border: 5px solid #880000;
            color: white; font-size: 24px; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="joystick-zone"></div>
    <div id="textbox"></div>
    <div id="starter-ui">
        <button class="choice-btn" onclick="choosePokemon('Treecko')">TREECKO (Grass)</button>
        <button class="choice-btn" onclick="choosePokemon('Charmander')">CHARMANDER (Fire)</button>
        <button class="choice-btn" onclick="choosePokemon('Froakie')">FROAKIE (Water)</button>
    </div>
</div>

<div id="controls">
    <div id="stick-hint" style="color:#666; font-size: 12px;">TOUCH LEFT TO MOVE</div>
    <button class="action-circle" id="btn-a">A</button>
</div>

<script>
/** * GAME CONFIG & STATE
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const textbox = document.getElementById('textbox');
const starterUI = document.getElementById('starter-ui');

canvas.width = 240; // GBA Width
canvas.height = 160; // GBA Height

let state = 'MOM_HOUSE'; 
let player = { x: 110, y: 100, dir: 'down', frame: 0 };
let shimmer = 0;
let dialogQueue = [];

// Narrative Script
const script = {
    intro: [
        "Mom: Wake up! You're finally awake.",
        "A letter arrived from Professor Sequoia. It's marked 'URGENT'!",
        "Your rival already left for the Lab... better hurry!",
        "Go through the door to Maple Root Town."
    ],
    lab1: [
        "Lab Assistant: Ah, you must be the other recruit!",
        "The Professor is waiting for you upstairs.",
        "Just head through that door—it'll take you right to his study!"
    ],
    sequoia: [
        "Sequoia: Welcome! Orebound is experiencing strange seismic tremors.",
        "I need you to help me study these three Pokémon.",
        "Go on... pick your partner."
    ]
};

/**
 * CORE LOGIC
 */
function update() {
    if (shimmer > 0) shimmer--;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. Draw World
    if (state === 'MOM_HOUSE') drawRoom('#d2b48c', "HOME");
    else if (state === 'TOWN') drawTown();
    else if (state === 'LAB_1F') drawLab1();
    else if (state === 'LAB_2F') drawLab2();

    // 2. Draw Player
    ctx.fillStyle = (shimmer > 0 && shimmer % 2 === 0) ? 'white' : '#3a86ff';
    ctx.fillRect(player.x, player.y, 14, 16);

    // 3. Shimmer Overlay
    if (shimmer > 0) {
        ctx.fillStyle = `rgba(255, 255, 255, ${shimmer/10})`;
        ctx.fillRect(0,0,canvas.width, canvas.height);
    }

    requestAnimationFrame(draw);
}

function drawRoom(color, label) {
    ctx.fillStyle = color;
    ctx.fillRect(10, 10, 220, 140);
    ctx.fillStyle = "#5d4037"; // Back Door
    ctx.fillRect(110, 10, 20, 5);
    ctx.fillStyle = "black";
    ctx.fillText(label, 20, 30);
}

function drawTown() {
    ctx.fillStyle = '#7cfc00'; // Grass
    ctx.fillRect(0,0, 240, 160);
    // Ancient Tree
    ctx.fillStyle = '#4b3621';
    ctx.fillRect(160, 20, 40, 60);
    // Lab Building
    ctx.fillStyle = '#95a5a6';
    ctx.fillRect(20, 20, 80, 50);
    ctx.fillStyle = '#2c3e50'; // Lab Door
    ctx.fillRect(50, 60, 20, 10);
}

function drawLab1() {
    ctx.fillStyle = '#ecf0f1';
    ctx.fillRect(0,0, 240, 160);
    // Water Tanks
    ctx.fillStyle = '#3498db';
    ctx.fillRect(150, 30, 60, 40);
    // Teleport Door
    ctx.fillStyle = '#e67e22';
    ctx.fillRect(110, 5, 20, 10);
}

function drawLab2() {
    ctx.fillStyle = '#f3e5ab';
    ctx.fillRect(0,0, 240, 160);
    // Study Desk
    ctx.fillStyle = '#5d4037';
    ctx.fillRect(80, 40, 80, 30);
    // Pokeballs
    ctx.fillStyle = 'red';
    ctx.beginPath(); ctx.arc(95, 55, 4, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(120, 55, 4, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(145, 55, 4, 0, Math.PI*2); ctx.fill();
}

/**
 * INTERACTION & NAVIGATION
 */
function handleInput() {
    // Collision / Teleport Check
    if (state === 'MOM_HOUSE' && player.y < 15) {
        teleport('TOWN', 60, 80);
    } else if (state === 'TOWN' && player.y < 70 && player.x < 100) {
        teleport('LAB_1F', 110, 130);
    } else if (state === 'LAB_1F' && player.y < 20) {
        teleport('LAB_2F', 110, 130);
    }
}

function teleport(newState, x, y) {
    shimmer = 20; // Trigger "Shimmer" pixel effect
    setTimeout(() => {
        state = newState;
        player.x = x;
        player.y = y;
        if(state === 'TOWN') triggerDialogue(script.intro);
        if(state === 'LAB_1F') triggerDialogue(script.lab1);
        if(state === 'LAB_2F') triggerDialogue(script.sequoia);
    }, 200);
}

function triggerDialogue(lines) {
    dialogQueue = [...lines];
    showNextLine();
}

function showNextLine() {
    if (dialogQueue.length > 0) {
        textbox.style.display = 'block';
        textbox.innerText = dialogQueue.shift();
    } else {
        textbox.style.display = 'none';
        if (state === 'LAB_2F') starterUI.style.display = 'flex';
    }
}

function choosePokemon(name) {
    starterUI.style.display = 'none';
    triggerDialogue([
        `You chose ${name}!`,
        "Rival: Then I'll take the other one! I won't lose!",
        "Sequoia: Here is your Pokedex. Orebound's future depends on you!"
    ]);
}

// Controls
document.getElementById('btn-a').addEventListener('click', () => {
    if (textbox.style.display === 'block') showNextLine();
    else if (state === 'MOM_HOUSE') triggerDialogue(script.intro);
});

// Joystick Simulation
let isMoving = false;
document.getElementById('joystick-zone').addEventListener('touchstart', (e) => {
    isMoving = true;
});
document.getElementById('joystick-zone').addEventListener('touchmove', (e) => {
    if(!isMoving) return;
    let touch = e.touches[0];
    if (touch.clientX < window.innerWidth / 2) {
        player.x += (touch.clientX - 100) * 0.05; // Simple dynamic float
        player.y += (touch.clientY - 300) * 0.05;
        handleInput();
    }
});
// Keyboard Fallback
window.onkeydown = (e) => {
    if (e.key === 'ArrowUp') player.y -= 5;
    if (e.key === 'ArrowDown') player.y += 5;
    if (e.key === 'ArrowLeft') player.x -= 5;
    if (e.key === 'ArrowRight') player.x += 5;
    if (e.key === 'z') document.getElementById('btn-a').click();
    handleInput();
};

setInterval(update, 1000/30);
draw();
</script>
</body>
</html>
