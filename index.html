<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Starter Selection</title>

<style>
    html, body {
        margin: 0;
        padding: 0;
        background: #000;
        touch-action: none;
        font-family: monospace;
        color: white;
    }

    #gameContainer {
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    canvas {
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        background: black;
    }

    #uiOverlay {
        position: absolute;
        width: 320px;
        height: 240px;
        transform: scale(4);
        pointer-events: none;
    }

    .dialogue {
        position: absolute;
        bottom: 8px;
        left: 8px;
        width: 304px;
        height: 56px;
        background: rgba(0,0,0,0.75);
        border: 2px solid gold;
        padding: 4px;
        font-size: 8px;
        line-height: 10px;
    }

    .infoPanel {
        position: absolute;
        top: 16px;
        right: 8px;
        width: 120px;
        height: 160px;
        background: rgba(0,0,0,0.85);
        border: 2px solid #aaa;
        padding: 4px;
        font-size: 8px;
        display: none;
    }
</style>
</head>

<body>
<div id="gameContainer">
    <canvas id="game" width="320" height="240"></canvas>

    <div id="uiOverlay">
        <div class="dialogue" id="dialogueBox"></div>
        <div class="infoPanel" id="infoPanel"></div>
    </div>
</div>

<script>
/* ======================================================
   CORE CONFIG
====================================================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const SCALE = 4;
canvas.style.width = (320 * SCALE) + "px";
canvas.style.height = (240 * SCALE) + "px";

const FPS = 60;
const FRAME_TIME = 1000 / FPS;

/* ======================================================
   STATE MACHINE
====================================================== */
const ScenePhase = {
    INTRO: 0,
    REVEAL: 1,
    SELECT: 2,
    CONFIRM: 3
};

let phase = ScenePhase.INTRO;
let phaseTimer = 0;

/* ======================================================
   WEATHER
====================================================== */
const weatherTypes = ["sunny", "rain", "night"];
const weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];

/* ======================================================
   STARTERS
====================================================== */
const starters = [
    { name: "Charmander", type: "Fire", color: "#ff6633", stats: [3,4,3] },
    { name: "Squirtle", type: "Water", color: "#3399ff", stats: [4,3,2] },
    { name: "Bulbasaur", type: "Grass", color: "#33cc66", stats: [4,3,3] }
];

let selectedIndex = -1;
let hoveredIndex = -1;

/* ======================================================
   INPUT
====================================================== */
let touchStartTime = 0;
let lastTapTime = 0;

/* ======================================================
   PARTICLES
====================================================== */
const particles = [];

function spawnParticles(x, y, type) {
    let count = type === "Fire" ? 3 : type === "Water" ? 2 : 2;
    for (let i = 0; i < count; i++) {
        particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 0.5,
            vy: -Math.random() * 0.5,
            life: 60 + Math.random() * 40,
            type
        });
    }
}

/* ======================================================
   DRAW HELPERS
====================================================== */
function drawPixelRect(x, y, w, h, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, w, h);
}

function drawText(text, x, y) {
    ctx.fillStyle = "white";
    ctx.font = "8px monospace";
    ctx.fillText(text, x, y);
}

/* ======================================================
   BACKGROUND
====================================================== */
function drawBackground() {
    // Far layer: window
    ctx.globalAlpha = 0.5;
    drawPixelRect(40, 16, 240, 80, "#223344");

    if (weather === "sunny") {
        ctx.fillStyle = "rgba(255,255,200,0.2)";
        ctx.fillRect(40, 16, 240, 80);
    } else if (weather === "rain") {
        ctx.strokeStyle = "#66aaff";
        for (let i = 0; i < 40; i++) {
            ctx.beginPath();
            ctx.moveTo(40 + Math.random()*240, 16 + Math.random()*80);
            ctx.lineTo(42 + Math.random()*240, 24 + Math.random()*80);
            ctx.stroke();
        }
    } else {
        ctx.fillStyle = "white";
        ctx.fillRect(200, 20, 6, 6);
    }

    ctx.globalAlpha = 1;

    // Mid layer: shelves
    drawPixelRect(16, 104, 288, 32, "#444");

    // Near layer: desk
    drawPixelRect(0, 160, 320, 80, "#333");
}

/* ======================================================
   PROFESSOR
====================================================== */
function drawProfessor() {
    let x = 32;
    let y = 96;

    drawPixelRect(x, y, 32, 48, "#cccccc");
    drawPixelRect(x+8, y-16, 16, 16, "#ffeecc");

    // Simple animation
    if (phase === ScenePhase.INTRO) {
        drawText("...", x+4, y-20);
    }
}

/* ======================================================
   POKEBALLS
====================================================== */
function drawPokeballs(dt) {
    starters.forEach((s, i) => {
        let px = 96 + i * 64;
        let py = 144;

        // pedestal
        drawPixelRect(px-8, py+16, 32, 8, "#555");

        // glow
        if (i === selectedIndex) {
            ctx.globalAlpha = 0.7 + Math.sin(Date.now()/200)*0.3;
            drawPixelRect(px-10, py-10, 36, 36, "gold");
            ctx.globalAlpha = 1;
        }

        // ball
        drawPixelRect(px, py, 16, 16, s.color);

        spawnParticles(px+8, py, s.type);
    });
}

/* ======================================================
   PARTICLES UPDATE
====================================================== */
function updateParticles() {
    for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life--;

        let c = p.type === "Fire" ? "#ff9966" :
                p.type === "Water" ? "#66ccff" : "#66ff99";

        drawPixelRect(p.x, p.y, 2, 2, c);

        if (p.life <= 0) particles.splice(i,1);
    }
}

/* ======================================================
   UI
====================================================== */
const dialogueBox = document.getElementById("dialogueBox");
const infoPanel = document.getElementById("infoPanel");

function updateDialogue() {
    if (phase === ScenePhase.INTRO) {
        dialogueBox.innerText =
            "Ah! Welcome!\nCome closer...\nI have Pokémon for you.";
    } else if (phase === ScenePhase.REVEAL) {
        dialogueBox.innerText =
            "These are Pokémon.\nChoose the one that will journey with you.";
    } else if (phase === ScenePhase.SELECT && selectedIndex >= 0) {
        dialogueBox.innerText =
            "You seem interested in " + starters[selectedIndex].name + ".";
    } else if (phase === ScenePhase.CONFIRM) {
        dialogueBox.innerText =
            "Excellent choice!\nYour adventure begins now!";
    }
}

function showInfo(index) {
    const s = starters[index];
    infoPanel.style.display = "block";
    infoPanel.innerHTML = `
        <div>[Sprite]</div>
        <div>NAME: ${s.name}</div>
        <div>TYPE: ${s.type}</div>
        <div>HP: ${"■".repeat(s.stats[0])}</div>
        <div>ATK: ${"■".repeat(s.stats[1])}</div>
        <div>SPD: ${"■".repeat(s.stats[2])}</div>
    `;
}

function hideInfo() {
    infoPanel.style.display = "none";
}

/* ======================================================
   INPUT HANDLING
====================================================== */
canvas.addEventListener("touchstart", e => {
    touchStartTime = performance.now();
});

canvas.addEventListener("touchend", e => {
    const now = performance.now();
    const duration = now - touchStartTime;

    const rect = canvas.getBoundingClientRect();
    const x = (e.changedTouches[0].clientX - rect.left) / SCALE;
    const y = (e.changedTouches[0].clientY - rect.top) / SCALE;

    starters.forEach((s, i) => {
        let px = 96 + i * 64;
        let py = 144;
        if (x > px && x < px+16 && y > py && y < py+16) {
            if (duration > 1000) {
                showInfo(i);
            } else {
                selectedIndex = i;
                if (now - lastTapTime < 300) {
                    phase = ScenePhase.CONFIRM;
                }
                lastTapTime = now;
            }
        }
    });
});

/* ======================================================
   MAIN LOOP
====================================================== */
let lastTime = 0;

function loop(time) {
    if (time - lastTime < FRAME_TIME) {
        requestAnimationFrame(loop);
        return;
    }
    lastTime = time;
    phaseTimer++;

    ctx.clearRect(0,0,320,240);

    drawBackground();
    drawProfessor();

    if (phase >= ScenePhase.REVEAL) {
        drawPokeballs();
    }

    updateParticles();
    updateDialogue();

    if (phase === ScenePhase.INTRO && phaseTimer > FPS * 2) {
        phase = ScenePhase.REVEAL;
    }
    if (phase === ScenePhase.REVEAL && phaseTimer > FPS * 5) {
        phase = ScenePhase.SELECT;
    }

    requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>
