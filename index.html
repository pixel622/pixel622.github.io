<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pokémon Kyan</title>
<style>
body {
margin: 0;
background: black;
overflow: hidden;
font-family: monospace;
}
#dialogue {
position: absolute;
bottom: 0;
width: 100%;
height: 120px;
background: rgba(0,0,0,0.8);
color: white;
padding: 10px;
display: none;
}
#choices {
position: absolute;
bottom: 140px;
width: 100%;
text-align: center;
display: none;
}
button {
font-size: 16px;
margin: 10px;
padding: 10px;
}
</style>
</head>

<body>

<canvas id="game" width="512" height="384"></canvas>

<div id="dialogue"></div>

<div id="choices">
<button onclick="choosePokemon('Treecko')">Treecko</button>
<button onclick="choosePokemon('Froakie')">Froakie</button>
<button onclick="choosePokemon('Charmander')">Charmander</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const images = {};
const imageNames = [
"player","professor","house_inside","house_outside","tree",
"charmander","froakie","treecko"
];

imageNames.forEach(name=>{
images[name] = new Image();
images[name].src = `images/${name}.png`;
});

let state = "intro"; // intro, house, outside
let dialogueIndex = 0;
let playerName = "";
let chosenPokemon = null;

const dialogueBox = document.getElementById("dialogue");

const introDialogue = [
"Bonjour ! Bienvenue dans le monde des Pokémon !",
"Je m'appelle Kyan... On m'appelle le Professeur Pokémon !",
"Ce monde est peuplé de créatures appelées Pokémon...",
"Quel est ton nom ?"
];

const player = {
x: 220, y: 200, w: 32, h: 32, speed: 2
};

const wallsHouse = [
{x:0,y:0,w:512,h:32},
{x:0,y:0,w:32,h:384},
{x:480,y:0,w:32,h:384},
{x:0,y:352,w:512,h:32}
];

const treesOutside = [];
for(let i=0;i<16;i++){
treesOutside.push({x:i*32,y:0,w:32,h:32});
treesOutside.push({x:i*32,y:352,w:32,h:32});
}
for(let i=1;i<10;i++){
treesOutside.push({x:0,y:i*32,w:32,h:32});
treesOutside.push({x:480,y:i*32,w:32,h:32});
}

const keys = {};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

canvas.addEventListener("click",()=>{
if(state==="intro"){
if(dialogueIndex===3){
playerName = prompt("Entre ton nom");
dialogueIndex++;
dialogueBox.innerText = "Ton aventure légendaire commence ! Clique encore.";
} else if(dialogueIndex>=4){
state="house";
dialogueBox.style.display="none";
} else {
dialogueBox.innerText = introDialogue[++dialogueIndex];
}
}
});

function collide(rects, nx, ny){
return rects.some(r =>
nx < r.x+r.w && nx+player.w > r.x &&
ny < r.y+r.h && ny+player.h > r.y
);
}

function update(){
let nx = player.x;
let ny = player.y;

if(keys["ArrowUp"]) ny -= player.speed;
if(keys["ArrowDown"]) ny += player.speed;
if(keys["ArrowLeft"]) nx -= player.speed;
if(keys["ArrowRight"]) nx += player.speed;

if(state==="house"){
if(!collide(wallsHouse,nx,ny)){
player.x=nx; player.y=ny;
}
if(player.y<40){
state="outside";
player.x=240; player.y=300;
}
}

if(state==="outside"){
if(!collide(treesOutside,nx,ny)){
player.x=nx; player.y=ny;
}
}
}

function draw(){
ctx.clearRect(0,0,512,384);

if(state==="intro"){
ctx.drawImage(images.professor,200,100,64,64);
dialogueBox.style.display="block";
dialogueBox.innerText = introDialogue[dialogueIndex];
}

if(state==="house"){
ctx.drawImage(images.house_inside,0,0,512,384);
ctx.drawImage(images.player,player.x,player.y,32,32);
if(!chosenPokemon){
document.getElementById("choices").style.display="block";
}
}

if(state==="outside"){
ctx.drawImage(images.house_outside,0,0,512,384);
treesOutside.forEach(t=>{
ctx.drawImage(images.tree,t.x,t.y,32,32);
});
ctx.drawImage(images.player,player.x,player.y,32,32);
}
}

function choosePokemon(p){
chosenPokemon=p;
document.getElementById("choices").style.display="none";
alert("Tu as choisi " + p + " !");
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
