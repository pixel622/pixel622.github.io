<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correcteur Orthographe & Grammaire</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --warning-color: #f72585;
            --success-color: #4cc9f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        header p {
            color: #6c757d;
        }

        .logo {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            font-size: 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 20px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .language-selector {
            display: flex;
            align-items: center;
            background: var(--light-color);
            padding: 10px 15px;
            border-radius: 10px;
            flex-grow: 1;
        }

        select {
            padding: 10px;
            font-size: 16px;
            border: none;
            background: transparent;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
        }

        .btn {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #e9ecef;
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: var(--light-color);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .corrected-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            font-size: 17px;
            line-height: 1.8;
            min-height: 200px;
            white-space: pre-wrap;
            border: 2px solid #e9ecef;
        }

        .corrected-word {
            background-color: rgba(67, 97, 238, 0.2);
            padding: 2px 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border-bottom: 2px dashed var(--primary-color);
        }

        .corrected-word:hover {
            background-color: rgba(67, 97, 238, 0.3);
            transform: translateY(-2px);
        }

        .explanation-popup {
            position: absolute;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 300px;
            display: none;
            border-left: 4px solid var(--warning-color);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation-content {
            font-size: 14px;
        }

        .explanation-title {
            color: var(--warning-color);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .explanation-title i {
            margin-right: 8px;
        }

        .suggestion {
            color: var(--primary-color);
            font-weight: 500;
            margin: 8px 0;
        }

        .copy-btn {
            background: var(--success-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .copy-btn:hover {
            background: #3ab8d8;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(67, 97, 238, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .message.error {
            background: #ffe6e6;
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }

        .info-text {
            color: #6c757d;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-spell-check"></i>
            </div>
            <h1>Correcteur Orthographe</h1>
            <p>Cliquez sur les mots surlignés pour voir les corrections</p>
        </header>

        <div class="card">
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <i class="fas fa-edit" style="color: var(--primary-color); margin-right: 10px;"></i>
                <h3 style="color: var(--secondary-color);">Texte à corriger</h3>
            </div>
            
            <textarea id="text" placeholder="Collez ou écrivez votre texte ici...">Le correcteur automatique est un outil incroyablement pratique pour les rédacteurs. Il permet de détecter les fotes d'ortographe, les erreur de grammaire et les problèmes de conjuguaison. Avec cette application, vous pouvez améliorer la qualité de vos textes en quelques secondes seulement.</textarea>
            
            <div class="controls">
                <div class="language-selector">
                    <i class="fas fa-globe" style="margin-right: 10px; color: var(--primary-color);"></i>
                    <select id="language">
                        <option value="fr">Français</option>
                        <option value="en">Anglais</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="effacerTexte()">
                        <i class="fas fa-eraser"></i> Effacer
                    </button>
                    <button class="btn btn-primary" onclick="corriger()">
                        <i class="fas fa-magic"></i> Corriger
                    </button>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="charCount">0</div>
                    <div class="stat-label">Caractères</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wordCount">0</div>
                    <div class="stat-label">Mots</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="errorCount">0</div>
                    <div class="stat-label">Corrections</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="result-header">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 10px;"></i>
                    <h3 style="color: var(--secondary-color);">Texte corrigé</h3>
                </div>
                <div style="color: #6c757d; font-size: 14px;">
                    <i class="fas fa-mouse-pointer"></i> Cliquez sur les mots surlignés
                </div>
            </div>
            
            <div id="resultContainer">
                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyse en cours...</p>
                </div>
                
                <div id="messageArea"></div>
                
                <div class="corrected-text" id="correctedText">
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <i class="fas fa-arrow-up" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        <p>Le texte corrigé apparaîtra ici</p>
                        <p class="info-text">Les corrections seront surlignées. Cliquez dessus pour voir les explications.</p>
                    </div>
                </div>
                
                <button class="copy-btn" onclick="copierTexte()" style="display: none;" id="copyBtn">
                    <i class="fas fa-copy"></i> Copier le texte corrigé
                </button>
            </div>
        </div>
        
        <footer>
            <p>Utilise l'API LanguageTool • Simple et efficace</p>
        </footer>
    </div>

    <!-- Popup pour les explications -->
    <div id="explanationPopup" class="explanation-popup"></div>

    <script>
        let currentMatches = [];
        let correctedTextPlain = "";
        
        // Initialiser les compteurs
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('text');
            mettreAJourCompteurs();
            
            textarea.addEventListener('input', mettreAJourCompteurs);
            
            // Fermer le popup en cliquant ailleurs
            document.addEventListener('click', function(event) {
                const popup = document.getElementById('explanationPopup');
                if (!event.target.classList.contains('corrected-word')) {
                    popup.style.display = 'none';
                }
            });
        });

        // Mettre à jour les compteurs
        function mettreAJourCompteurs() {
            const text = document.getElementById('text').value;
            const charCount = text.length;
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('wordCount').textContent = wordCount;
        }

        // Effacer le texte
        function effacerTexte() {
            document.getElementById('text').value = '';
            document.getElementById('messageArea').innerHTML = '';
            document.getElementById('correctedText').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-arrow-up" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    <p>Le texte corrigé apparaîtra ici</p>
                    <p class="info-text">Les corrections seront surlignées. Cliquez dessus pour voir les explications.</p>
                </div>
            `;
            document.getElementById('copyBtn').style.display = 'none';
            document.getElementById('errorCount').textContent = '0';
            mettreAJourCompteurs();
            
            afficherMessage('Texte effacé.', 'success');
        }

        // Afficher un message
        function afficherMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const icon = type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle';
            const messageClass = type === 'error' ? 'error' : 'success';
            
            messageArea.innerHTML = `
                <div class="message ${messageClass}">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 3000);
        }

        // Fonction principale de correction
        async function corriger() {
            const text = document.getElementById('text').value;
            const lang = document.getElementById('language').value;
            
            if (!text.trim()) {
                afficherMessage('Veuillez entrer un texte à corriger.', 'error');
                return;
            }
            
            // Afficher le chargement
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('messageArea').innerHTML = '';
            document.getElementById('copyBtn').style.display = 'none';
            
            try {
                const response = await fetch("https://api.languagetool.org/v2/check", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({
                        text: text,
                        language: lang,
                        enabledOnly: "false"
                    })
                });

                const data = await response.json();
                document.getElementById('loading').style.display = 'none';
                
                // Stocker les erreurs pour les popups
                currentMatches = data.matches || [];
                
                if (currentMatches.length > 0) {
                    afficherTexteCorrige(text, currentMatches);
                    document.getElementById('errorCount').textContent = currentMatches.length;
                    afficherMessage(`${currentMatches.length} correction(s) appliquée(s).`, 'success');
                } else {
                    // Aucune erreur
                    correctedTextPlain = text;
                    document.getElementById('correctedText').innerHTML = text.replace(/\n/g, '<br>');
                    document.getElementById('errorCount').textContent = '0';
                    document.getElementById('copyBtn').style.display = 'block';
                    afficherMessage('Aucune erreur détectée !', 'success');
                }
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                afficherMessage('Erreur de connexion. Réessayez.', 'error');
            }
        }

        // Afficher le texte corrigé avec les mots surlignés
        function afficherTexteCorrige(originalText, matches) {
            let correctedText = originalText;
            let segments = [];
            let lastIndex = 0;
            
            // Trier les matches par position
            matches.sort((a, b) => a.offset - b.offset);
            
            // Appliquer les corrections et préparer les segments pour l'affichage
            matches.forEach((match, index) => {
                if (match.replacements && match.replacements.length > 0) {
                    // Segment avant la correction
                    segments.push({
                        text: correctedText.slice(lastIndex, match.offset),
                        isCorrected: false
                    });
                    
                    // Segment corrigé
                    const correctedSegment = match.replacements[0].value;
                    segments.push({
                        text: correctedSegment,
                        isCorrected: true,
                        matchIndex: index,
                        original: correctedText.slice(match.offset, match.offset + match.length)
                    });
                    
                    // Mettre à jour le texte corrigé
                    correctedText =
                        correctedText.slice(0, match.offset) +
                        correctedSegment +
                        correctedText.slice(match.offset + match.length);
                    
                    lastIndex = match.offset + correctedSegment.length;
                }
            });
            
            // Ajouter le reste du texte
            if (lastIndex < correctedText.length) {
                segments.push({
                    text: correctedText.slice(lastIndex),
                    isCorrected: false
                });
            }
            
            // Construire le HTML avec les mots cliquables
            let html = '';
            segments.forEach(segment => {
                if (segment.isCorrected) {
                    const match = matches[segment.matchIndex];
                    const message = match.message || "Correction suggérée";
                    const suggestion = match.replacements[0].value;
                    const original = segment.original;
                    
                    html += `<span class="corrected-word" 
                        data-message="${message.replace(/"/g, '&quot;')}" 
                        data-suggestion="${suggestion.replace(/"/g, '&quot;')}"
                        data-original="${original.replace(/"/g, '&quot;')}"
                        onclick="montrerExplication(this, event)">${segment.text}</span>`;
                } else {
                    html += segment.text;
                }
            });
            
            // Mettre à jour l'affichage
            document.getElementById('correctedText').innerHTML = html.replace(/\n/g, '<br>');
            document.getElementById('copyBtn').style.display = 'block';
            
            // Stocker le texte corrigé (sans HTML) pour la copie
            correctedTextPlain = correctedText;
        }

        // Montrer l'explication quand on clique sur un mot corrigé
        function montrerExplication(element, event) {
            event.stopPropagation();
            
            const popup = document.getElementById('explanationPopup');
            const message = element.getAttribute('data-message');
            const suggestion = element.getAttribute('data-suggestion');
            const original = element.getAttribute('data-original');
            
            // Positionner le popup près du mot cliqué
            const rect = element.getBoundingClientRect();
            popup.style.left = rect.left + 'px';
            popup.style.top = (rect.bottom + 5) + 'px';
            
            // Contenu du popup
            popup.innerHTML = `
                <div class="explanation-content">
                    <div class="explanation-title">
                        <i class="fas fa-exclamation-circle"></i>
                        ${message}
                    </div>
                    <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 4px;">
                        <strong>Original:</strong> <span style="color: ${'#f72585'}">${original}</span>
                    </div>
                    <div class="suggestion">
                        <strong>Correction:</strong> ${suggestion}
                    </div>
                </div>
            `;
            
            // Afficher le popup
            popup.style.display = 'block';
            
            // Ajuster la position si le popup dépasse de l'écran
            const popupRect = popup.getBoundingClientRect();
            if (popupRect.right > window.innerWidth) {
                popup.style.left = (rect.left - (popupRect.width - rect.width)) + 'px';
            }
        }

        // Copier le texte corrigé
        function copierTexte() {
            navigator.clipboard.writeText(correctedTextPlain)
                .then(() => {
                    const copyBtn = document.getElementById('copyBtn');
                    const originalHTML = copyBtn.innerHTML;
                    
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copié !';
                    copyBtn.style.background = '#2e7d32';
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.style.background = '';
                    }, 2000);
                })
                .catch(err => {
                    afficherMessage('Erreur lors de la copie', 'error');
                });
        }
    </script>
</body>
</html>
