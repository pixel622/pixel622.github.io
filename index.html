
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pokémon K&E Version</title>

<style>
:root {
    --gba-blue:#285088;
    --gba-light-blue:#5888c8;
    --font-main:'Courier New', monospace;
}
html,body{
    margin:0;
    width:100%;
    height:100%;
    background:black;
    overflow:hidden;
}
canvas{
    width:100%!important;
    height:100%!important;
    image-rendering:pixelated;
}
#title-screen{
    position:absolute; inset:0;
    background:black;
    color:white;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:5;
    font-family:var(--font-main);
}
#start-btn{
    padding:15px 40px;
    font-size:20px;
    background:var(--gba-blue);
    color:white;
    border:4px solid white;
    border-radius:12px;
}
#ui-layer{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    width:90%;
    display:none;
}
#dialogue-box{
    background:white;
    border:6px solid var(--gba-blue);
    border-radius:18px;
    padding:20px;
    font-size:20px;
    font-weight:bold;
}
#speaker-tag{
    position:absolute;
    top:-26px;
    left:30px;
    background:var(--gba-blue);
    color:white;
    padding:5px 18px;
    border-radius:10px 10px 0 0;
}
#joystick-wrapper{
    position:absolute;
    bottom:80px;
    left:40px;
    width:130px;
    height:130px;
    border-radius:50%;
    background:rgba(255,255,255,0.15);
}
#joystick-knob{
    width:50px;
    height:50px;
    background:rgba(255,255,255,0.6);
    border-radius:50%;
    position:absolute;
    left:40px;
    top:40px;
}
#bag-btn{
    position:absolute;
    bottom:80px;
    right:40px;
    background:var(--gba-blue);
    color:white;
    padding:14px 30px;
    border:3px solid white;
    border-radius:8px;
}
#shimmer{
    position:fixed;
    inset:0;
    background:white;
    opacity:0;
    transition:opacity .3s;
    pointer-events:none;
}
</style>
</head>

<body>
<div id="title-screen">
    <h1 style="color:#ffcb05;text-shadow:3px 3px #2a75bb;">Pokémon K&E Version</h1>
    <button id="start-btn" onclick="startGame()">START GAME</button>
</div>

<canvas id="gameCanvas"></canvas>
<div id="shimmer"></div>
<div id="bag-btn" onclick="alert('Bag is empty!')">BAG</div>

<div id="ui-layer" onclick="handleDialogueClick()">
    <div id="speaker-tag">Professor Sequoia</div>
    <div id="dialogue-box">Welcome to the Habitat Research Lab!</div>
</div>

<div id="joystick-wrapper">
    <div id="joystick-knob"></div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const uiLayer = document.getElementById("ui-layer");
const dialogueBox = document.getElementById("dialogue-box");
const titleScreen = document.getElementById("title-screen");

let width,height;
function resize(){
    width=innerWidth;
    height=innerHeight;
    canvas.width=width;
    canvas.height=height;
}
addEventListener("resize",resize);
resize();

const script=[
 "Welcome to the Habitat Research Lab!",
 "This place studies Orebound's ecosystems.",
 "A tremor shook the region earlier...",
 "Choose a Pokémon partner!"
];
let scriptIndex=0;

let currentMap="LAB";
let choosingState=false;
let holdingPokeball=false;

const player={x:width/2,y:height-120,speed:5,history:[]};
const follower={active:false,x:0,y:0,color:"#000",bob:0};

const pokeballs=[
 {name:"Treecko",color:"#32cd32",active:true},
 {name:"Froakie",color:"#1e90ff",active:true},
 {name:"Charmander",color:"#ff4500",active:true}
];

function startGame(){
    titleScreen.style.display="none";
    uiLayer.style.display="block";
}

function handleDialogueClick(){
    if(scriptIndex<script.length-1){
        scriptIndex++;
        dialogueBox.innerText=script[scriptIndex];
    }else{
        uiLayer.style.display="none";
        choosingState=true;
    }
}

/* ===== GRAPHICS HELPERS ===== */
function shadowCircle(x,y,r,color){
    ctx.fillStyle="rgba(0,0,0,.25)";
    ctx.beginPath();
    ctx.ellipse(x,y+r+6,r*.9,r*.4,0,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle=color;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
}

function pokeball(x,y){
    ctx.beginPath();
    ctx.fillStyle="#c00";
    ctx.arc(x,y,16,Math.PI,0);
    ctx.fill();
    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(x,y,16,0,Math.PI);
    ctx.fill();
    ctx.strokeStyle="black";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(x-16,y);
    ctx.lineTo(x+16,y);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(x,y,4,0,Math.PI*2);
    ctx.stroke();
}

/* ===== MAIN LOOP ===== */
function draw(){
ctx.clearRect(0,0,width,height);

/* ===== LAB ===== */
if(currentMap==="LAB"){
    let g=ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,"#e0a070");
    g.addColorStop(1,"#c08050");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,width,height);

    // desk
    const dW=360,dH=110,dX=width/2-dW/2,dY=height/2.4;
    ctx.fillStyle="#6b3b1e";
    ctx.fillRect(dX,dY,dW,dH);
    ctx.fillStyle="#8c522f";
    ctx.fillRect(dX,dY,dW,14);

    pokeballs.forEach((b,i)=>{
        if(!b.active)return;
        b.x=dX+70+i*110;
        b.y=dY+55;
        ctx.fillStyle="black";
        ctx.fillText(b.name.toUpperCase(),b.x,b.y-30);
        pokeball(b.x,b.y);
    });
}

/* ===== OUTSIDE ===== */
else{
    let sky=ctx.createLinearGradient(0,0,0,height/2);
    sky.addColorStop(0,"#7db9e8");
    sky.addColorStop(1,"#9fe09f");
    ctx.fillStyle=sky;
    ctx.fillRect(0,0,width,height);

    // grass
    ctx.fillStyle="#5f9f5f";
    ctx.fillRect(0,height/2,width,height);

    // pond
    ctx.fillStyle="#1e5aab";
    ctx.beginPath();
    ctx.ellipse(width/2-350,height/2-40,150,90,0,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="rgba(255,255,255,.25)";
    ctx.beginPath();
    ctx.ellipse(width/2-380,height/2-70,50,25,0,0,Math.PI*2);
    ctx.fill();

    // house
    const hX=width/2-120,hY=height/2-150;
    ctx.fillStyle="#a0c0d8";
    ctx.fillRect(hX,hY,240,160);
    ctx.fillStyle="#d05050";
    ctx.beginPath();
    ctx.moveTo(hX-20,hY);
    ctx.lineTo(width/2,hY-70);
    ctx.lineTo(hX+260,hY);
    ctx.fill();
}

/* ===== FOLLOWER ===== */
if(follower.active){
    follower.bob+=0.1;
    shadowCircle(
        follower.x,
        follower.y+Math.sin(follower.bob)*3,
        14,
        follower.color
    );
}

/* ===== PLAYER ===== */
ctx.fillStyle="rgba(0,0,0,.25)";
ctx.beginPath();
ctx.ellipse(player.x,player.y+22,14,6,0,0,Math.PI*2);
ctx.fill();

ctx.fillStyle="#a03030";
ctx.fillRect(player.x-15,player.y-10,30,25);
ctx.fillStyle="#ffdbac";
ctx.fillRect(player.x-10,player.y-28,20,18);

if(holdingPokeball){
    pokeball(player.x+18,player.y+2);
}

requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
