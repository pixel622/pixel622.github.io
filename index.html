<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pokemon Github Edition</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #333; image-rendering: pixelated; max-width: 100%; max-height: 100%; border: 4px solid #fff; }
        
        /* UI Elements */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #dialogue-box { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; height: 120px; background: white; border: 4px solid #444; border-radius: 10px;
            padding: 15px; box-sizing: border-box; display: none; pointer-events: auto;
        }
        #name-input-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 20px; border-radius: 10px; display: none; pointer-events: auto;
        }
        
        /* Mobile Controls */
        #controls { position: absolute; bottom: 20px; left: 20px; width: 150px; height: 150px; pointer-events: auto; display: none; }
        .joystick-base { width: 100px; height: 100px; background: rgba(255,255,255,0.3); border-radius: 50%; position: relative; }
        .joystick-stick { width: 50px; height: 50px; background: #fff; border-radius: 50%; position: absolute; top: 25px; left: 25px; }
        #action-btn { position: absolute; bottom: 40px; right: 40px; width: 70px; height: 70px; background: red; border-radius: 50%; border: 5px solid white; pointer-events: auto; display: none; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div id="name-input-container">
            <p>Enter your name:</p>
            <input type="text" id="player-name" maxlength="10">
            <button onclick="submitName()">Confirm</button>
        </div>

        <div id="dialogue-box" onclick="nextDialogue()">
            <div id="dialogue-text"></div>
            <div id="starter-choices" style="display:none; margin-top:10px;">
                <button onclick="pickStarter('Treecko')">Treecko</button>
                <button onclick="pickStarter('Froakie')">Froakie</button>
                <button onclick="pickStarter('Charmander')">Charmander</button>
            </div>
        </div>
    </div>

    <div id="controls">
        <div class="joystick-base" id="joy-base">
            <div class="joystick-stick" id="joy-stick"></div>
        </div>
    </div>
    <div id="action-btn" onclick="handleAction()"></div>
</div>

<script>
/** GAME CONFIG **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400; // Small POV as requested
canvas.height = 400;

let gameState = 'LOGO'; 
let playerName = 'Trainer';
let dialogueIndex = 0;
let currentDialogues = [];

// Replace these URLs with your uploaded file paths
const assets = {
    player: { x: 180, y: 300, w: 32, h: 32, color: 'red' },
    house: { x: 100, y: 50, w: 200, h: 150, color: 'blue' },
    door: { x: 120, y: 170, w: 40, h: 30 }
};

const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

/** INTRO SEQUENCE **/
const introText = [
    "Hello there! Welcome to the world of Pokémon!",
    "My name is Kyan! ...",
    "People call me the Pokémon Prof!",
    "This world is inhabited by creatures called Pokémon!",
    "Myself… I study Pokémon as a profession...",
    "First, what is your name?"
];

const postNameText = [
    "Your very own Pokémon legend is about to unfold!",
    "A world of dreams and adventures awaits! Let's go!"
];

// Initialize Game
function init() {
    drawLogo();
}

function drawLogo() {
    ctx.fillStyle = 'black';
    ctx.fillRect(0,0, canvas.width, canvas.height);
    ctx.fillStyle = 'yellow';
    ctx.font = '30px Arial';
    ctx.fillText("POKEMON", 130, 180);
    ctx.fillStyle = 'white';
    ctx.font = '14px Arial';
    ctx.fillText("Click anywhere to start", 125, 220);
}

canvas.addEventListener('click', () => {
    if(gameState === 'LOGO') {
        gameState = 'PROFESSOR';
        startDialogue(introText);
    }
});

function startDialogue(textArray) {
    currentDialogues = textArray;
    dialogueIndex = 0;
    document.getElementById('dialogue-box').style.display = 'block';
    updateDialogueText();
}

function updateDialogueText() {
    const text = currentDialogues[dialogueIndex];
    document.getElementById('dialogue-text').innerText = text;
    
    if (text === "First, what is your name?") {
        document.getElementById('name-input-container').style.display = 'block';
    }
}

function nextDialogue() {
    if (gameState === 'NAME_ENTRY') return;
    
    dialogueIndex++;
    if (dialogueIndex < currentDialogues.length) {
        updateDialogueText();
    } else {
        if (gameState === 'PROFESSOR') {
            gameState = 'NAME_ENTRY';
        } else if (gameState === 'LEGEND_START') {
            document.getElementById('dialogue-box').style.display = 'none';
            spawnInWorld();
        } else if (gameState === 'STARTER_SELECT') {
             document.getElementById('starter-choices').style.display = 'block';
        }
    }
}

function submitName() {
    playerName = document.getElementById('player-name').value || 'Trainer';
    document.getElementById('name-input-container').style.display = 'none';
    gameState = 'LEGEND_START';
    startDialogue([`Hello ${playerName}! ` + postNameText[0], postNameText[1]]);
}

function spawnInWorld() {
    gameState = 'WORLD';
    document.getElementById('controls').style.display = 'block';
    document.getElementById('action-btn').style.display = 'block';
    gameLoop();
    
    // Professor greeting trigger
    setTimeout(() => {
        startDialogue([
            `Hello ${playerName}, this is the beginning of your adventure!`,
            "Before you start, you will need to choose a Pokémon..."
        ]);
        gameState = 'STARTER_SELECT';
    }, 1000);
}

function pickStarter(pokemon) {
    alert(`You chose ${pokemon}!`);
    document.getElementById('starter-choices').style.display = 'none';
    document.getElementById('dialogue-box').style.display = 'none';
    gameState = 'WORLD';
}

/** GAME ENGINE **/
function update() {
    if (gameState !== 'WORLD') return;

    let nextX = assets.player.x;
    let nextY = assets.player.y;
    const speed = 2;

    if (keys['ArrowUp']) nextY -= speed;
    if (keys['ArrowDown']) nextY += speed;
    if (keys['ArrowLeft']) nextX -= speed;
    if (keys['ArrowRight']) nextX += speed;

    // Boundary Collision (Walls)
    if (nextX > 0 && nextX < canvas.width - assets.player.w) assets.player.x = nextX;
    if (nextY > 0 && nextY < canvas.height - assets.player.h) assets.player.y = nextY;

    // Door Collision (Teleport Logic)
    if (assets.player.x > assets.door.x && 
        assets.player.x < assets.door.x + assets.door.w &&
        assets.player.y > assets.door.y && 
        assets.player.y < assets.door.y + assets.door.h) {
            // Simple visual feedback for "entering"
            console.log("Entering House...");
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw Outside World
    ctx.fillStyle = '#4CAF50'; // Grass
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Draw House
    ctx.fillStyle = assets.house.color;
    ctx.fillRect(assets.house.x, assets.house.y, assets.house.w, assets.house.h);
    
    // Draw Door
    ctx.fillStyle = '#654321';
    ctx.fillRect(assets.door.x, assets.door.y, assets.door.w, assets.door.h);

    // Draw Player
    ctx.fillStyle = assets.player.color;
    ctx.fillRect(assets.player.x, assets.player.y, assets.player.w, assets.player.h);
}

function gameLoop() {
    update();
    draw();
    if (gameState === 'WORLD' || gameState === 'STARTER_SELECT') {
        requestAnimationFrame(gameLoop);
    }
}

init();
</script>
</body>
</html>
