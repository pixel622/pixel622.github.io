<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Untitled 2D Pixel Pokémon Adventure</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #222; image-rendering: pixelated; border: 4px solid #444; }
        
        /* UI Elements */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #dialogue-box { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px; height: 120px; background: rgba(0, 0, 0, 0.85);
            border: 3px solid white; padding: 15px; box-sizing: border-box;
            display: none; pointer-events: auto; cursor: pointer;
        }
        #name-input-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #000; padding: 20px; border: 2px solid white; display: none; pointer-events: auto;
        }
        #joystick {
            position: absolute; bottom: 40px; left: 40px; width: 100px; height: 100px;
            background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: none; pointer-events: auto;
        }
        .btn { background: white; color: black; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <!-- Dialogue System -->
        <div id="dialogue-box" onclick="advanceDialogue()">
            <div id="dialogue-text"></div>
            <div style="text-align: right; margin-top: 10px;">...</div>
        </div>

        <!-- Name Entry -->
        <div id="name-input-container" id="name-ui">
            <p>Enter your name, Trainer:</p>
            <input type="text" id="name-field" maxlength="10">
            <button class="btn" onclick="submitName()">CONFIRM</button>
        </div>

        <!-- Starter Selection -->
        <div id="starter-ui" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; pointer-events: auto; text-align: center;">
            <h3>Choose your partner:</h3>
            <button class="btn" onclick="chooseStarter('Treecko')">TREECKO</button>
            <button class="btn" onclick="chooseStarter('Froakie')">FROAKIE</button>
            <button class="btn" onclick="chooseStarter('Charmander')">CHARMANDER</button>
        </div>

        <!-- Mobile Joystick -->
        <div id="joystick"></div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const diagBox = document.getElementById('dialogue-box');
    const diagText = document.getElementById('dialogue-text');

    // Game State
    let gameState = 'INTRO';
    let playerName = '';
    let playerStarter = '';
    let currentMap = 'HOUSE'; // HOUSE or WORLD
    
    // Player Object
    const player = {
        x: 150, y: 150, size: 32, speed: 3,
        color: 'red' // Representing the red hat trainer
    };

    // Dialogue Queue
    let dialogueLines = [];
    let currentLineIndex = 0;

    // Initialize Canvas
    function init() {
        canvas.width = 400;
        canvas.height = 400;
        startIntro();
    }

    function startIntro() {
        gameState = 'INTRO';
        showDialogue([
            "Welcome! It is a pleasure to meet you. I am Professor Kyan.",
            "I am a researcher. My life’s work is dedicated to studying Pokémon...",
            "Some keep them as pets. Others use them for combat. But for all, they are partners.",
            "But enough about me. Tell me... what is your name?"
        ], () => {
            document.getElementById('name-input-container').style.display = 'block';
        });
    }

    function submitName() {
        playerName = document.getElementById('name-field').value || "Trainer";
        document.getElementById('name-input-container').style.display = 'none';
        showDialogue([
            `${playerName}! What a legendary name.`,
            "Your journey of dreams and adventures is about to begin!",
            "Click START to enter your home."
        ], () => {
            spawnInHouse();
        });
    }

    function spawnInHouse() {
        gameState = 'PLAYING';
        currentMap = 'HOUSE';
        diagBox.style.display = 'none';
        document.getElementById('joystick').style.display = 'block';
        
        // Secondary encounter with Kyan inside house
        setTimeout(() => {
            showDialogue([
                `There you are, ${playerName}!`,
                "Today is the day you become a Trainer.",
                "Choose your first partner..."
            ], () => {
                document.getElementById('starter-ui').style.display = 'block';
            });
        }, 500);
    }

    function chooseStarter(choice) {
        playerStarter = choice;
        document.getElementById('starter-ui').style.display = 'none';
        showDialogue([
            `${choice}! A fine choice!`,
            "Go now! Head to the door to start your adventure."
        ]);
    }

    // Dialogue Logic
    function showDialogue(lines, callback) {
        dialogueLines = lines;
        currentLineIndex = 0;
        diagBox.style.display = 'block';
        diagText.innerText = dialogueLines[currentLineIndex];
        onDialogueEnd = callback;
    }

    function advanceDialogue() {
        currentLineIndex++;
        if (currentLineIndex < dialogueLines.length) {
            diagText.innerText = dialogueLines[currentLineIndex];
        } else {
            diagBox.style.display = 'none';
            if (onDialogueEnd) onDialogueEnd();
        }
    }

    // Controls
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // Game Loop
    function update() {
        if (gameState === 'PLAYING' && diagBox.style.display === 'none') {
            let nextX = player.x;
            let nextY = player.y;

            if (keys['ArrowUp'] || keys['KeyW']) nextY -= player.speed;
            if (keys['ArrowDown'] || keys['KeyS']) nextY += player.speed;
            if (keys['ArrowLeft'] || keys['KeyA']) nextX -= player.speed;
            if (keys['ArrowRight'] || keys['KeyD']) nextX += player.speed;

            // Simple Collision (Stay inside 400x400)
            if (nextX > 20 && nextX < 350) player.x = nextX;
            if (nextY > 20 && nextY < 350) player.y = nextY;

            // Teleport Logic (Door at bottom)
            if (currentMap === 'HOUSE' && player.y > 340) {
                currentMap = 'WORLD';
                player.y = 50; // Spawn at top of outside map
            }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameState === 'PLAYING') {
            // Draw Environment
            if (currentMap === 'HOUSE') {
                ctx.fillStyle = '#5d4037'; // Brown floor
                ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#333'; // Walls
                ctx.fillRect(0,0,400,20);
                ctx.fillStyle = 'blue'; // Rug/Table placeholder
                ctx.fillRect(150, 150, 100, 60);
            } else {
                ctx.fillStyle = '#2e7d32'; // Green grass
                ctx.fillRect(0,0,400,400);
            }

            // Draw Player (Red Hat Trainer)
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x, player.y, player.size, player.size);
            ctx.fillStyle = 'red'; // The Hat
            ctx.fillRect(player.x, player.y, player.size, 10);

            // Restricted POV (Vignette Effect)
            const gradient = ctx.createRadialGradient(
                player.x + 16, player.y + 16, 50, 
                player.x + 16, player.y + 16, 150
            );
            gradient.addColorStop(0, 'rgba(0,0,0,0)');
            gradient.addColorStop(1, 'rgba(0,0,0,0.95)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        } else {
            // Intro Background
            ctx.fillStyle = 'black';
            ctx.fillRect(0,0,canvas.width, canvas.height);
        }

        requestAnimationFrame(() => {
            update();
            draw();
        });
    }

    init();
    draw();

</script>
</body>
</html>


