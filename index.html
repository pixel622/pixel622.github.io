<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Gamma Village</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
        }

        /* Game Container */
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
        }

        /* Title Screen */
        #titleScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9)),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><rect width="400" height="400" fill="%23005287"/><circle cx="200" cy="200" r="150" fill="%23006bb3"/><circle cx="200" cy="200" r="100" fill="%230084d1"/></svg>');
            background-size: cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .title-logo {
            font-size: 48px;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700,
                         0 0 20px #ffd700,
                         2px 2px 0 #000,
                         -2px -2px 0 #000;
            margin-bottom: 50px;
            animation: logoGlow 2s infinite;
            letter-spacing: 5px;
        }

        @keyframes logoGlow {
            0%, 100% { text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 2px 2px 0 #000; }
            50% { text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 2px 2px 0 #000; }
        }

        .title-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .title-btn {
            background: linear-gradient(to bottom, #4a90e2, #2c6cb0);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            min-width: 200px;
        }

        .title-btn:hover {
            background: linear-gradient(to bottom, #5a9cf2, #3c7cd0);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }

        /* Joystick */
        #joyBase {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #4a90e2;
            border-radius: 50%;
            z-index: 100;
            box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
            display: none;
            touch-action: none;
        }

        #joy {
            position: absolute;
            width: 50px;
            height: 50px;
            left: 35px;
            top: 35px;
            background: linear-gradient(to bottom, #ffd700, #ffaa00);
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            transition: transform 0.1s;
        }

        /* HUD */
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(to right, rgba(0, 40, 80, 0.9), rgba(0, 60, 120, 0.9));
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            border: 3px solid #4a90e2;
            font-size: 14px;
            z-index: 50;
            display: none;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
            backdrop-filter: blur(5px);
        }

        /* Dialog Box */
        #dialogBox {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 800px;
            background: linear-gradient(to bottom, rgba(0, 40, 80, 0.95), rgba(0, 60, 120, 0.95));
            border: 4px solid #ffd700;
            border-radius: 20px;
            padding: 25px;
            color: white;
            font-size: 18px;
            z-index: 800;
            display: none;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .dialog-text {
            margin-bottom: 20px;
            min-height: 80px;
            line-height: 1.6;
            text-shadow: 1px 1px 2px #000;
        }

        .dialog-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .dialog-btn {
            background: linear-gradient(to bottom, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 150px;
        }

        /* Controls */
        #controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
            display: none;
        }

        .control-btn {
            background: linear-gradient(to bottom, #4a90e2, #2c6cb0);
            border: 3px solid #fff;
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        /* Village Sign */
        .village-sign {
            position: absolute;
            background: linear-gradient(to bottom, #8b4513, #654321);
            color: #ffd700;
            padding: 10px 20px;
            border: 3px solid #ffd700;
            border-radius: 10px;
            font-size: 20px;
            text-align: center;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* Minimap */
        #minimap {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #4a90e2;
            border-radius: 10px;
            z-index: 50;
            display: none;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        /* NPC Dialog */
        .npc-dialog {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid #4a90e2;
            font-size: 14px;
            max-width: 200px;
            text-align: center;
            z-index: 20;
            display: none;
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .title-logo { font-size: 32px; }
            .title-btn { padding: 12px 30px; font-size: 18px; min-width: 180px; }
            #joyBase { width: 100px; height: 100px; }
            #joy { width: 40px; height: 40px; left: 30px; top: 30px; }
            #minimap { width: 120px; height: 120px; }
        }
    </style>
</head>
<body>
    <!-- Title Screen -->
    <div id="titleScreen">
        <div class="title-logo">POK√âMON VILLAGE</div>
        <div class="title-menu">
            <button class="title-btn" onclick="startGame()">START GAME</button>
            <button class="title-btn" onclick="showCredits()">CREDITS</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- Dialog Box -->
        <div id="dialogBox">
            <div class="dialog-text" id="dialogText"></div>
            <div class="dialog-options" id="dialogOptions"></div>
        </div>

        <!-- Controls -->
        <div id="joyBase"><div id="joy"></div></div>
        <div id="hud">
            <div id="hudContent">Welcome to the Village!</div>
        </div>
        <div id="controls">
            <div class="control-btn" onclick="interact()">üí¨</div>
            <div class="control-btn" onclick="toggleMap()">üó∫Ô∏è</div>
        </div>
        
        <!-- Minimap -->
        <canvas id="minimap"></canvas>
    </div>

    <script>
        // Game initialization
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const minimapCanvas = document.getElementById('minimap');
        const minimapCtx = minimapCanvas.getContext('2d');
        
        // Game state
        let gameState = {
            player: {
                x: 400,
                y: 300,
                direction: 0, // 0: down, 1: left, 2: right, 3: up
                speed: 3,
                spriteFrame: 0,
                inHouse: false,
                currentHouse: null
            },
            camera: { x: 0, y: 0 },
            village: {
                name: "Sunflower Village",
                time: "Morning",
                weather: "Sunny"
            },
            inDialog: false,
            showMinimap: false
        };

        // Village Data - Houses and Buildings
        const village = {
            // Main village area
            bounds: { x: 0, y: 0, width: 1600, height: 1200 },
            
            // Houses (20 houses in total)
            houses: [
                // Row 1 - Upper village (5 houses)
                { id: 1, x: 200, y: 100, width: 80, height: 60, color: '#a0522d', roof: '#8b4513', name: "Pok√©mon Lab", type: "lab" },
                { id: 2, x: 320, y: 100, width: 70, height: 55, color: '#d2691e', roof: '#8b4513', name: "Trainer House", type: "house" },
                { id: 3, x: 420, y: 100, width: 75, height: 58, color: '#cd853f', roof: '#8b4513', name: "Berry Shop", type: "shop" },
                { id: 4, x: 520, y: 100, width: 65, height: 52, color: '#8b4513', roof: '#654321', name: "Family Home", type: "house" },
                { id: 5, x: 620, y: 100, width: 80, height: 60, color: '#a0522d', roof: '#8b4513', name: "Day Care", type: "special" },
                
                // Row 2 - Middle village (5 houses)
                { id: 6, x: 180, y: 220, width: 72, height: 56, color: '#d2691e', roof: '#8b4513', name: "Item Shop", type: "shop" },
                { id: 7, x: 280, y: 220, width: 68, height: 54, color: '#cd853f', roof: '#8b4513', name: "Home", type: "house" },
                { id: 8, x: 380, y: 220, width: 76, height: 59, color: '#8b4513', roof: '#654321', name: "Gym", type: "gym" },
                { id: 9, x: 500, y: 220, width: 70, height: 55, color: '#a0522d', roof: '#8b4513', name: "Pok√© Mart", type: "shop" },
                { id: 10, x: 600, y: 220, width: 65, height: 52, color: '#d2691e', roof: '#8b4513', name: "Home", type: "house" },
                
                // Row 3 - Lower village (5 houses)
                { id: 11, x: 150, y: 350, width: 78, height: 60, color: '#cd853f', roof: '#8b4513', name: "Pok√© Center", type: "center", color: '#ff9999', roof: '#ff6b6b' },
                { id: 12, x: 260, y: 350, width: 72, height: 56, color: '#8b4513', roof: '#654321', name: "Home", type: "house" },
                { id: 13, x: 370, y: 350, width: 70, height: 55, color: '#a0522d', roof: '#8b4513', name: "School", type: "special" },
                { id: 14, x: 480, y: 350, width: 68, height: 54, color: '#d2691e', roof: '#8b4513', name: "Home", type: "house" },
                { id: 15, x: 590, y: 350, width: 75, height: 58, color: '#cd853f', roof: '#8b4513', name: "Trainer's House", type: "house" },
                
                // Row 4 - Bottom village (5 houses)
                { id: 16, x: 220, y: 480, width: 70, height: 55, color: '#8b4513', roof: '#654321', name: "Home", type: "house" },
                { id: 17, x: 320, y: 480, width: 65, height: 52, color: '#a0522d', roof: '#8b4513', name: "Move Tutor", type: "special" },
                { id: 18, x: 420, y: 480, width: 80, height: 60, color: '#d2691e', roof: '#8b4513', name: "Battle House", type: "special" },
                { id: 19, x: 530, y: 480, width: 72, height: 56, color: '#cd853f', roof: '#8b4513', name: "Home", type: "house" },
                { id: 20, x: 640, y: 480, width: 68, height: 54, color: '#8b4513', roof: '#654321', name: "Elder's House", type: "house" }
            ],
            
            // NPCs with dialog
            npcs: [
                { x: 240, y: 180, type: 'scientist', dialog: "Welcome to our Pok√©mon Lab! We research Pok√©mon evolution here." },
                { x: 350, y: 180, type: 'trainer', dialog: "I'm training my Pok√©mon for the upcoming tournament!" },
                { x: 550, y: 180, type: 'child', dialog: "Look at my cute Pok√©mon! Want to see?" },
                { x: 200, y: 280, type: 'shopkeeper', dialog: "Fresh berries for sale! Good for your Pok√©mon's health." },
                { x: 410, y: 280, type: 'gymleader', dialog: "The gym is open! Challenge me if you dare!" },
                { x: 620, y: 280, type: 'oldman', dialog: "I've lived here for 50 years. This village has grown so much!" },
                { x: 180, y: 410, type: 'nurse', dialog: "Welcome to the Pok√©mon Center! We heal your Pok√©mon for free." },
                { x: 400, y: 410, type: 'teacher', dialog: "I teach young trainers about Pok√©mon types and weaknesses." },
                { x: 610, y: 410, type: 'fisherman', dialog: "Caught any good Pok√©mon lately? The lake has Magikarp." },
                { x: 320, y: 530, type: 'move_tutor', dialog: "I can teach special moves to your Pok√©mon. Come see me!" }
            ],
            
            // Special locations
            special: [
                { x: 700, y: 200, type: 'fountain', name: "Village Fountain" },
                { x: 100, y: 300, type: 'statue', name: "Founder's Statue" },
                { x: 750, y: 400, type: 'bench', name: "Resting Bench" },
                { x: 100, y: 550, type: 'tree', name: "Ancient Tree" }
            ],
            
            // Paths connecting houses
            paths: [
                // Main horizontal paths
                { x: 150, y: 180, width: 550, height: 20, color: '#8b7355' },
                { x: 150, y: 300, width: 550, height: 20, color: '#8b7355' },
                { x: 150, y: 420, width: 550, height: 20, color: '#8b7355' },
                { x: 150, y: 540, width: 550, height: 20, color: '#8b7355' },
                
                // Vertical paths
                { x: 250, y: 80, width: 20, height: 520, color: '#8b7355' },
                { x: 450, y: 80, width: 20, height: 520, color: '#8b7355' },
                { x: 650, y: 80, width: 20, height: 520, color: '#8b7355' },
                
                // Cross paths
                { x: 350, y: 240, width: 20, height: 120, color: '#8b7355' },
                { x: 550, y: 240, width: 20, height: 120, color: '#8b7355' }
            ],
            
            // Trees and decorations
            trees: [
                { x: 100, y: 150, size: 25, color: '#2d5a27' },
                { x: 100, y: 450, size: 30, color: '#2d5a27' },
                { x: 750, y: 150, size: 28, color: '#2d5a27' },
                { x: 750, y: 450, size: 26, color: '#2d5a27' },
                { x: 50, y: 300, size: 32, color: '#2d5a27' },
                { x: 800, y: 300, size: 30, color: '#2d5a27' },
                // Row of trees
                { x: 50, y: 100, size: 20, color: '#2d5a27' },
                { x: 50, y: 200, size: 22, color: '#2d5a27' },
                { x: 50, y: 400, size: 24, color: '#2d5a27' },
                { x: 50, y: 500, size: 21, color: '#2d5a27' },
                { x: 800, y: 100, size: 23, color: '#2d5a27' },
                { x: 800, y: 200, size: 25, color: '#2d5a27' },
                { x: 800, y: 400, size: 22, color: '#2d5a27' },
                { x: 800, y: 500, size: 24, color: '#2d5a27' }
            ],
            
            // Flowers and bushes
            decorations: []
        };

        // Generate random decorations
        for (let i = 0; i < 100; i++) {
            village.decorations.push({
                x: Math.random() * 800,
                y: Math.random() * 600,
                type: Math.random() > 0.5 ? 'flower' : 'bush',
                color: ['#ff6b9d', '#ffd166', '#06d6a0', '#118ab2'][Math.floor(Math.random() * 4)],
                size: Math.random() * 8 + 4
            });
        }

        // Initialize game
        function initGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            minimapCanvas.width = 150;
            minimapCanvas.height = 150;
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
            
            // Setup joystick
            setupJoystick();
            
            // Start game loop
            gameLoop();
        }

        // Joystick controls
        let joystick = { x: 0, y: 0, active: false };
        function setupJoystick() {
            const joyBase = document.getElementById('joyBase');
            const joyStick = document.getElementById('joy');

            joyBase.addEventListener('mousedown', startDrag);
            joyBase.addEventListener('touchstart', startDrag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);

            function startDrag(e) {
                e.preventDefault();
                joystick.active = true;
                updateJoystick(e);
            }

            function endDrag() {
                joystick.active = false;
                joystick.x = joystick.y = 0;
                joyStick.style.transform = 'translate(0, 0)';
            }

            function drag(e) {
                if (!joystick.active) return;
                updateJoystick(e);
            }

            function updateJoystick(e) {
                const rect = joyBase.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                
                let x = touch.clientX - rect.left - 60;
                let y = touch.clientY - rect.top - 60;
                
                const distance = Math.sqrt(x * x + y * y);
                const maxDistance = 50;
                
                if (distance > maxDistance) {
                    x = (x / distance) * maxDistance;
                    y = (y / distance) * maxDistance;
                }
                
                joystick.x = x / maxDistance;
                joystick.y = y / maxDistance;
                
                joyStick.style.transform = `translate(${x}px, ${y}px)`;
                
                // Update player direction
                if (Math.abs(joystick.x) > Math.abs(joystick.y)) {
                    gameState.player.direction = joystick.x > 0 ? 2 : 1;
                } else {
                    gameState.player.direction = joystick.y > 0 ? 0 : 3;
                }
            }
        }

        // Dialog system
        function showDialog(text, options = []) {
            gameState.inDialog = true;
            document.getElementById('dialogText').textContent = text;
            const optionsDiv = document.getElementById('dialogOptions');
            optionsDiv.innerHTML = '';
            
            if (options.length === 0) {
                const btn = document.createElement('button');
                btn.className = 'dialog-btn';
                btn.textContent = 'Continue';
                btn.onclick = () => {
                    document.getElementById('dialogBox').style.display = 'none';
                    gameState.inDialog = false;
                };
                optionsDiv.appendChild(btn);
            } else {
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'dialog-btn';
                    btn.textContent = opt.text;
                    btn.onclick = () => {
                        document.getElementById('dialogBox').style.display = 'none';
                        gameState.inDialog = false;
                        opt.action();
                    };
                    optionsDiv.appendChild(btn);
                });
            }
            
            document.getElementById('dialogBox').style.display = 'block';
        }

        // Interaction system
        function interact() {
            if (gameState.inDialog) return;
            
            // Check for nearby NPCs
            for (const npc of village.npcs) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - npc.x, 2) + 
                    Math.pow(gameState.player.y - npc.y, 2)
                );
                
                if (distance < 50) {
                    showDialog(`${getNPCTypeName(npc.type)}: "${npc.dialog}"`);
                    return;
                }
            }
            
            // Check for nearby houses
            for (const house of village.houses) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - house.x, 2) + 
                    Math.pow(gameState.player.y - house.y, 2)
                );
                
                if (distance < 60) {
                    if (gameState.player.inHouse && gameState.player.currentHouse === house.id) {
                        // Exit house
                        gameState.player.inHouse = false;
                        gameState.player.currentHouse = null;
                        showDialog(`You left ${house.name}.`);
                    } else if (!gameState.player.inHouse) {
                        // Enter house
                        gameState.player.inHouse = true;
                        gameState.player.currentHouse = house.id;
                        const houseDialog = getHouseDialog(house);
                        showDialog(houseDialog);
                    }
                    return;
                }
            }
            
            // Check for special locations
            for (const special of village.special) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - special.x, 2) + 
                    Math.pow(gameState.player.y - special.y, 2)
                );
                
                if (distance < 40) {
                    showDialog(`You're at the ${special.name}. ${getSpecialDialog(special.type)}`);
                    return;
                }
            }
            
            // Default dialog
            showDialog("There's nothing special here. Try talking to someone or entering a building.");
        }

        function getNPCTypeName(type) {
            const names = {
                'scientist': 'Scientist',
                'trainer': 'Pok√©mon Trainer',
                'child': 'Youngster',
                'shopkeeper': 'Shopkeeper',
                'gymleader': 'Gym Leader',
                'oldman': 'Elder',
                'nurse': 'Nurse Joy',
                'teacher': 'Teacher',
                'fisherman': 'Fisherman',
                'move_tutor': 'Move Tutor'
            };
            return names[type] || 'Villager';
        }

        function getHouseDialog(house) {
            const dialogs = {
                'lab': `Welcome to ${house.name}! This is where Pok√©mon research happens.`,
                'shop': `Welcome to ${house.name}! We have items for sale.`,
                'gym': `Welcome to ${house.name}! Trainers battle here.`,
                'center': `Welcome to ${house.name}! We heal your Pok√©mon.`,
                'special': `You entered ${house.name}.`,
                'house': `You're in ${house.name}. It's cozy inside.`
            };
            return dialogs[house.type] || `You entered ${house.name}.`;
        }

        function getSpecialDialog(type) {
            const dialogs = {
                'fountain': "The water looks refreshing!",
                'statue': "This statue commemorates the village founder.",
                'bench': "A good place to rest and watch the village.",
                'tree': "This ancient tree has stood here for centuries."
            };
            return dialogs[type] || "This is a special place in the village.";
        }

        // Minimap
        function toggleMap() {
            gameState.showMinimap = !gameState.showMinimap;
            document.getElementById('minimap').style.display = gameState.showMinimap ? 'block' : 'none';
        }

        function renderMinimap() {
            if (!gameState.showMinimap) return;
            
            minimapCtx.clearRect(0, 0, 150, 150);
            
            // Draw minimap background
            minimapCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            minimapCtx.fillRect(0, 0, 150, 150);
            
            // Draw village bounds
            const scale = 0.1;
            const offsetX = 10;
            const offsetY = 10;
            
            // Draw paths
            minimapCtx.fillStyle = '#8b7355';
            village.paths.forEach(path => {
                minimapCtx.fillRect(
                    path.x * scale + offsetX,
                    path.y * scale + offsetY,
                    path.width * scale,
                    path.height * scale
                );
            });
            
            // Draw houses
            village.houses.forEach(house => {
                minimapCtx.fillStyle = house.type === 'center' ? '#ff9999' : '#a0522d';
                minimapCtx.fillRect(
                    house.x * scale + offsetX,
                    house.y * scale + offsetY,
                    house.width * scale,
                    house.height * scale
                );
            });
            
            // Draw player
            minimapCtx.fillStyle = '#ff4444';
            minimapCtx.beginPath();
            minimapCtx.arc(
                gameState.player.x * scale + offsetX,
                gameState.player.y * scale + offsetY,
                3, 0, Math.PI * 2
            );
            minimapCtx.fill();
            
            // Draw border
            minimapCtx.strokeStyle = '#4a90e2';
            minimapCtx.lineWidth = 2;
            minimapCtx.strokeRect(0, 0, 150, 150);
            
            // Draw label
            minimapCtx.fillStyle = '#fff';
            minimapCtx.font = '10px Arial';
            minimapCtx.fillText('SUNFLOWER VILLAGE', 5, 145);
        }

        // Rendering
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (gameState.player.inHouse) {
                renderHouseInterior();
            } else {
                renderVillage();
            }
            
            renderMinimap();
        }

        function renderVillage() {
            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 5; i++) {
                const cloudX = (gameState.camera.x * 0.1 + i * 150) % (canvas.width + 300) - 150;
                const cloudY = 50 + Math.sin(Date.now() * 0.0003 + i) * 25;
                drawCloud(cloudX, cloudY);
            }
            
            // Apply camera transform
            ctx.save();
            ctx.translate(canvas.width/2 - gameState.player.x, canvas.height/2 - gameState.player.y);
            
            // Draw paths
            village.paths.forEach(path => {
                ctx.fillStyle = path.color;
                ctx.fillRect(path.x, path.y, path.width, path.height);
            });
            
            // Draw decorations
            village.decorations.forEach(deco => {
                ctx.fillStyle = deco.color;
                if (deco.type === 'flower') {
                    ctx.beginPath();
                    ctx.arc(deco.x, deco.y, deco.size/2, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.beginPath();
                    ctx.arc(deco.x, deco.y, deco.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // Draw trees
            village.trees.forEach(tree => {
                ctx.fillStyle = tree.color;
                ctx.beginPath();
                ctx.arc(tree.x, tree.y, tree.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Tree trunk
                ctx.fillStyle = '#8b4513';
                ctx.fillRect(tree.x - 5, tree.y + tree.size/2, 10, 20);
            });
            
            // Draw houses
            village.houses.forEach(house => {
                drawHouse(house);
                
                // House label
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(house.name, house.x + house.width/2, house.y - 10);
            });
            
            // Draw NPCs
            village.npcs.forEach(npc => {
                drawNPC(npc);
            });
            
            // Draw special locations
            village.special.forEach(special => {
                drawSpecial(special);
            });
            
            // Draw village boundaries
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, 700, 550);
            
            // Draw village sign
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(350, 30, 100, 40);
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('SUNFLOWER VILLAGE', 400, 55);
            
            // Draw player
            drawPlayer();
            
            ctx.restore();
        }

        function drawCloud(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.arc(x + 25, y - 10, 25, 0, Math.PI * 2);
            ctx.arc(x + 55, y, 20, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawHouse(house) {
            // Main building
            ctx.fillStyle = house.color || '#a0522d';
            ctx.fillRect(house.x, house.y, house.width, house.height);
            
            // Roof
            ctx.fillStyle = house.roof || '#8b4513';
            ctx.beginPath();
            ctx.moveTo(house.x - 10, house.y);
            ctx.lineTo(house.x + house.width/2, house.y - 20);
            ctx.lineTo(house.x + house.width + 10, house.y);
            ctx.closePath();
            ctx.fill();
            
            // Door
            ctx.fillStyle = '#654321';
            ctx.fillRect(house.x + house.width/2 - 8, house.y + house.height - 20, 16, 20);
            
            // Windows
            ctx.fillStyle = '#4a8bca';
            ctx.fillRect(house.x + 15, house.y + 15, 12, 12);
            ctx.fillRect(house.x + house.width - 27, house.y + 15, 12, 12);
            
            // Special features based on type
            if (house.type === 'center') {
                // Red cross
                ctx.fillStyle = '#ff4444';
                ctx.fillRect(house.x + house.width/2 - 15, house.y - 25, 30, 5);
                ctx.fillRect(house.x + house.width/2 - 2, house.y - 35, 4, 25);
            } else if (house.type === 'shop') {
                // Shop sign
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(house.x + house.width/2, house.y - 25, 10, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawNPC(npc) {
            // NPC body
            const npcColors = {
                'scientist': '#4a90e2',
                'trainer': '#ff4444',
                'child': '#ff6b9d',
                'shopkeeper': '#8b4513',
                'gymleader': '#ffd700',
                'oldman': '#888',
                'nurse': '#ff9999',
                'teacher': '#78c850',
                'fisherman': '#6890f0',
                'move_tutor': '#f08030'
            };
            
            ctx.fillStyle = npcColors[npc.type] || '#fff';
            ctx.beginPath();
            ctx.arc(npc.x, npc.y, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // NPC face
            ctx.fillStyle = '#ffcc99';
            ctx.beginPath();
            ctx.arc(npc.x, npc.y - 3, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // Interaction indicator
            ctx.fillStyle = '#4a90e2';
            ctx.beginPath();
            ctx.arc(npc.x, npc.y - 20, 4, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSpecial(special) {
            switch(special.type) {
                case 'fountain':
                    ctx.fillStyle = '#4a8bca';
                    ctx.beginPath();
                    ctx.arc(special.x, special.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Water effect
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    for(let i = 0; i < 3; i++) {
                        const offset = Math.sin(Date.now() * 0.002 + i) * 3;
                        ctx.beginPath();
                        ctx.arc(special.x, special.y - 5 + offset, 8, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                    
                case 'statue':
                    ctx.fillStyle = '#888';
                    // Base
                    ctx.fillRect(special.x - 10, special.y, 20, 5);
                    // Body
                    ctx.fillRect(special.x - 5, special.y - 20, 10, 20);
                    // Head
                    ctx.beginPath();
                    ctx.arc(special.x, special.y - 25, 5, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'bench':
                    ctx.fillStyle = '#8b4513';
                    // Seat
                    ctx.fillRect(special.x - 20, special.y, 40, 5);
                    // Back
                    ctx.fillRect(special.x - 20, special.y - 10, 40, 3);
                    // Legs
                    ctx.fillRect(special.x - 18, special.y + 5, 4, 10);
                    ctx.fillRect(special.x + 14, special.y + 5, 4, 10);
                    break;
                    
                case 'tree':
                    ctx.fillStyle = '#2d5a27';
                    ctx.beginPath();
                    ctx.arc(special.x, special.y, 20, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#8b4513';
                    ctx.fillRect(special.x - 8, special.y + 15, 16, 25);
                    break;
            }
        }

        function drawPlayer() {
            const player = gameState.player;
            
            // Walking animation
            if (joystick.x !== 0 || joystick.y !== 0) {
                player.spriteFrame = (player.spriteFrame + 0.2) % 8;
            }
            
            // Draw player (trainer)
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Body
            ctx.fillStyle = '#ff4444'; // Red hat
            ctx.fillRect(-8, -20, 16, 8);
            
            ctx.fillStyle = '#2c8bff'; // Blue shirt
            ctx.fillRect(-10, -12, 20, 16);
            
            ctx.fillStyle = '#000'; // Pants
            ctx.fillRect(-10, 4, 20, 8);
            
            // Face
            ctx.fillStyle = '#ffcc99';
            ctx.beginPath();
            ctx.arc(0, -15, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // Hair
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(-8, -22, 16, 8);
            
            // Legs with animation
            let legOffset = 0;
            if (joystick.x !== 0 || joystick.y !== 0) {
                legOffset = Math.sin(player.spriteFrame) * 3;
            }
            
            ctx.fillStyle = '#000';
            ctx.fillRect(-6, 12, 4, 8 + legOffset);
            ctx.fillRect(2, 12, 4, 8 - legOffset);
            
            // Interaction indicator
            if (checkNearbyInteraction()) {
                ctx.fillStyle = '#4a90e2';
                ctx.beginPath();
                ctx.arc(0, -30, 5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }

        function renderHouseInterior() {
            // House interior background
            ctx.fillStyle = '#d2b48c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Wood floor pattern
            for(let x = 0; x < canvas.width; x += 40) {
                for(let y = 0; y < canvas.height; y += 40) {
                    ctx.fillStyle = (x + y) % 80 === 0 ? '#8b7355' : '#a0522d';
                    ctx.fillRect(x, y, 40, 40);
                }
            }
            
            // Furniture
            const house = village.houses.find(h => h.id === gameState.player.currentHouse);
            if (house) {
                ctx.fillStyle = '#fff';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(house.name, canvas.width/2, 50);
                
                // Draw some furniture based on house type
                ctx.fillStyle = '#8b4513';
                
                if (house.type === 'house') {
                    // Bed
                    ctx.fillRect(canvas.width/2 - 60, canvas.height/2 - 30, 120, 60);
                    // Table
                    ctx.fillRect(canvas.width/2 - 40, canvas.height/2 + 50, 80, 20);
                    // Chairs
                    ctx.fillRect(canvas.width/2 - 60, canvas.height/2 + 40, 20, 30);
                    ctx.fillRect(canvas.width/2 + 40, canvas.height/2 + 40, 20, 30);
                } else if (house.type === 'shop') {
                    // Counter
                    ctx.fillRect(canvas.width/2 - 100, canvas.height/2 - 20, 200, 40);
                    // Shelves
                    for(let i = 0; i < 3; i++) {
                        ctx.fillRect(canvas.width/2 - 120, canvas.height/2 - 80 + i * 30, 240, 5);
                    }
                }
            }
            
            // Exit sign
            ctx.fillStyle = '#333';
            ctx.fillRect(canvas.width/2 - 40, canvas.height - 80, 80, 30);
            ctx.fillStyle = '#fff';
            ctx.font = '16px Arial';
            ctx.fillText('EXIT', canvas.width/2, canvas.height - 60);
            
            // Draw player in house
            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2);
            drawPlayer();
            ctx.restore();
        }

        function checkNearbyInteraction() {
            // Check NPCs
            for (const npc of village.npcs) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - npc.x, 2) + 
                    Math.pow(gameState.player.y - npc.y, 2)
                );
                if (distance < 50) return true;
            }
            
            // Check houses
            for (const house of village.houses) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - house.x, 2) + 
                    Math.pow(gameState.player.y - house.y, 2)
                );
                if (distance < 60) return true;
            }
            
            // Check special locations
            for (const special of village.special) {
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - special.x, 2) + 
                    Math.pow(gameState.player.y - special.y, 2)
                );
                if (distance < 40) return true;
            }
            
            return false;
        }

        // Game loop
        function gameLoop() {
            // Update player position
            if (!gameState.inDialog && !gameState.player.inHouse) {
                gameState.player.x += joystick.x * gameState.player.speed;
                gameState.player.y += joystick.y * gameState.player.speed;
                
                // Keep player in village bounds
                gameState.player.x = Math.max(50, Math.min(750, gameState.player.x));
                gameState.player.y = Math.max(50, Math.min(550, gameState.player.y));
            }
            
            // Update HUD
            document.getElementById('hudContent').innerHTML = `
                Sunflower Village<br>
                Position: ${Math.floor(gameState.player.x)}, ${Math.floor(gameState.player.y)}<br>
                ${gameState.player.inHouse ? 'Inside Building' : 'Exploring Village'}
            `;
            
            // Render
            render();
            
            // Next frame
            requestAnimationFrame(gameLoop);
        }

        // Start game
        function startGame() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('joyBase').style.display = 'block';
            document.getElementById('hud').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            
            showDialog("Welcome to Sunflower Village! A peaceful village with many houses and friendly people. Use the joystick to move and the üí¨ button to interact with villagers and buildings.");
            
            initGame();
        }

        function showCredits() {
            showDialog("Pok√©mon Village Adventure\n\nCreated with HTML5 Canvas\nInspired by Pok√©mon games\n\nUse the joystick to explore!");
        }
    </script>
</body>
</html>
