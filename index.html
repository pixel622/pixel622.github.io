<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar & Conjugation Corrector - English/French</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 75px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        /* Header */
        header {
            background: linear-gradient(to right, #283593, #5c6bc0);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 8px;
        }

        .header-left .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        .language-badge {
            display: inline-block;
            padding: 6px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        select, .btn {
            padding: 12px 25px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select {
            background: white;
            color: #333;
            min-width: 180px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        select:focus {
            outline: none;
            border-color: #5c6bc0;
            box-shadow: 0 0 0 3px rgba(92, 107, 192, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #26A69A 0%, #4DB6AC 100%);
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(38, 166, 154, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(38, 166, 154, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-clear {
            background: linear-gradient(135deg, #EF5350 0%, #E57373 100%);
            box-shadow: 0 4px 15px rgba(239, 83, 80, 0.3);
        }

        .btn-clear:hover {
            box-shadow: 0 8px 25px rgba(239, 83, 80, 0.4);
        }

        .btn-copy {
            background: linear-gradient(135deg, #42A5F5 0%, #64B5F6 100%);
            box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3);
        }

        .btn-copy:hover {
            box-shadow: 0 8px 25px rgba(66, 165, 245, 0.4);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
            min-height: 600px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #e8e8e8;
        }

        .panel-title {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-title .icon {
            font-size: 1.5rem;
        }

        .panel-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #ffcdd2;
        }

        .badge-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #c8e6c9;
        }

        /* Text Areas */
        .text-container {
            flex: 1;
            border: 3px solid #e8e8e8;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: #fafafa;
        }

        .text-area-wrapper {
            position: relative;
            height: 100%;
        }

        .text-area {
            width: 100%;
            height: 100%;
            min-height: 400px;
            padding: 25px;
            border: none;
            resize: none;
            font-size: 16px;
            line-height: 1.8;
            background: transparent;
            color: #333;
            font-family: 'Georgia', 'Times New Roman', serif;
        }

        .text-area:focus {
            outline: none;
        }

        /* Error Highlighting */
        .error-highlight {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 152, 0, 0.2) 100%);
            border-bottom: 3px solid #FFA000;
            position: relative;
            cursor: help;
            padding: 1px 2px;
            border-radius: 3px;
        }

        .error-highlight:hover {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3) 0%, rgba(255, 152, 0, 0.3) 100%);
        }

        .error-marker {
            position: absolute;
            right: -18px;
            top: -8px;
            font-size: 12px;
            color: #FF6D00;
        }

        /* Correction Info */
        .correction-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background: white;
            padding: 10px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            color: #555;
            z-index: 10;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-count {
            font-weight: 700;
            font-size: 1.2rem;
            min-width: 25px;
            text-align: center;
        }

        .info-count.error {
            color: #d32f2f;
        }

        .info-count.corrected {
            color: #2e7d32;
        }

        /* Loading */
        .loading {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .loading.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5c6bc0;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
            margin-bottom: 10px;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 20px 40px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        @media (max-width: 900px) {
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: #283593;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
            border-top: 1px solid #dee2e6;
        }

        .language-indicator {
            display: inline-block;
            padding: 8px 20px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 20px;
            margin: 10px 0;
            font-size: 0.9rem;
            border: 1px solid #bbdefb;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip strong {
            color: #FFA000;
            display: block;
            margin-bottom: 5px;
        }

        .tooltip .suggestion {
            color: #4CAF50;
            font-weight: 600;
        }

        /* Success Message */
        .message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message.show {
            display: flex;
        }

        .message.error {
            background: #f44336;
            box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);
        }

        /* Corrected Text */
        .corrected-word {
            background: #e8f5e9;
            border-bottom: 2px solid #4caf50;
            padding: 1px 2px;
            border-radius: 3px;
        }

        .improved-word {
            background: #e3f2fd;
            border-bottom: 2px solid #2196f3;
            padding: 1px 2px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üìö Grammar & Conjugation Corrector</h1>
                <div class="subtitle">Corrects EVERYTHING in English & French - Grammar, Conjugation, Spelling, Style</div>
                <div class="language-badge">
                    <span>üá¨üáß English ‚Ä¢ üá´üá∑ Fran√ßais</span>
                </div>
            </div>
            <div class="controls">
                <select id="languageSelect">
                    <option value="en-US">üá∫üá∏ English (US)</option>
                    <option value="en-GB">üá¨üáß English (UK)</option>
                    <option value="fr-FR">üá´üá∑ French (France)</option>
                    <option value="fr-CA">üá®üá¶ French (Canada)</option>
                </select>
                <button id="correctBtn" class="btn">
                    <span>üîç Correct Everything</span>
                </button>
                <button id="clearBtn" class="btn btn-clear">
                    <span>üóëÔ∏è Clear All</span>
                </button>
                <button id="copyBtn" class="btn btn-copy">
                    <span>üìã Copy Corrected</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <!-- Original Text Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">üìù</span>
                        Original Text with Errors
                    </div>
                    <div class="panel-badge badge-error" id="errorCountBadge">
                        <span id="errorCount">0</span> errors
                    </div>
                </div>
                <div class="text-container">
                    <div class="correction-info">
                        <div class="info-item">
                            <span class="info-count error" id="originalErrorCount">0</span>
                            <span>errors</span>
                        </div>
                        <div style="width: 1px; height: 20px; background: #ddd;"></div>
                        <div class="info-item">
                            <span class="info-count" id="wordCount">0</span>
                            <span>words</span>
                        </div>
                    </div>
                    <div class="text-area-wrapper">
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <div class="loading-text">Correcting text...</div>
                            <div style="font-size: 0.9rem; color: #666;">Checking grammar, conjugation, spelling...</div>
                        </div>
                        <div class="text-area" id="originalText" contenteditable="true" spellcheck="false">
ENGLISH EXAMPLE WITH ERRORS:

Hello their,

I goes to school every day. She don't like apples. We was at the park yesterday. Him and me goes to the store. The dog chase the cat. They was happy to see we.

Common conjugation errors:
- He go to work ‚Üí He goes to work
- She write a letter ‚Üí She writes a letter
- I has a book ‚Üí I have a book
- They doesn't understand ‚Üí They don't understand

Spelling errors: definately, seperate, occured, recieve, wierd

FRENCH EXAMPLE WITH ERRORS:

Je aller au supermarch√© hier. Tu mange une pomme. Il parle pas anglais. Nous allons au cin√©ma demain. Vous regarder la t√©l√©vision. Ils mange du pain.

Erreurs de conjugaison courantes:
- Je va ‚Üí Je vais
- Tu mange ‚Üí Tu manges
- Il parlent ‚Üí Il parle
- Nous sommes all√© ‚Üí Nous sommes all√©s
- Vous avez manger ‚Üí Vous avez mang√©
- Ils sont parti ‚Üí Ils sont partis

Fautes d'orthographe: apres, quand, jusqu'a, cote, tache
                        </div>
                    </div>
                </div>
            </div>

            <!-- Corrected Text Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">‚úÖ</span>
                        Corrected Text
                    </div>
                    <div class="panel-badge badge-success" id="correctionCountBadge">
                        <span id="correctionCount">0</span> corrections
                    </div>
                </div>
                <div class="text-container">
                    <div class="correction-info">
                        <div class="info-item">
                            <span class="info-count corrected" id="correctedCount">0</span>
                            <span>corrections</span>
                        </div>
                        <div style="width: 1px; height: 20px; background: #ddd;"></div>
                        <div class="info-item">
                            <span class="info-count" id="charCount">0</span>
                            <span>chars</span>
                        </div>
                    </div>
                    <div class="text-area-wrapper">
                        <div class="text-area" id="correctedText" contenteditable="false">
                            <!-- Corrected text will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="statWords">0</div>
                <div class="stat-label">Total Words</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statErrors">0</div>
                <div class="stat-label">Errors Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statGrammar">0</div>
                <div class="stat-label">Grammar Fixed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statConjugation">0</div>
                <div class="stat-label">Conjugation</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statSpelling">0</div>
                <div class="stat-label">Spelling</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statStyle">0</div>
                <div class="stat-label">Style Improvements</div>
            </div>
        </div>

        <footer>
            <p>‚úÖ <strong>Corrects EVERYTHING:</strong> Grammar ‚Ä¢ Conjugation ‚Ä¢ Spelling ‚Ä¢ Punctuation ‚Ä¢ Style</p>
            <div class="language-indicator" id="currentLanguage">Current Language: English (US)</div>
            <p style="margin-top: 10px; font-size: 0.85rem; color: #888;">
                Orange highlights show errors. Hover for details. Works completely offline.
            </p>
        </footer>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Message -->
    <div class="message" id="message"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const originalText = document.getElementById('originalText');
            const correctedText = document.getElementById('correctedText');
            const languageSelect = document.getElementById('languageSelect');
            const correctBtn = document.getElementById('correctBtn');
            const clearBtn = document.getElementById('clearBtn');
            const copyBtn = document.getElementById('copyBtn');
            const loading = document.getElementById('loading');
            const tooltip = document.getElementById('tooltip');
            const message = document.getElementById('message');
            
            // Stats elements
            const errorCount = document.getElementById('errorCount');
            const originalErrorCount = document.getElementById('originalErrorCount');
            const wordCount = document.getElementById('wordCount');
            const charCount = document.getElementById('charCount');
            const correctionCount = document.getElementById('correctionCount');
            const correctedCount = document.getElementById('correctedCount');
            const errorCountBadge = document.getElementById('errorCountBadge');
            const correctionCountBadge = document.getElementById('correctionCountBadge');
            const currentLanguage = document.getElementById('currentLanguage');
            
            // Main stats
            const statWords = document.getElementById('statWords');
            const statErrors = document.getElementById('statErrors');
            const statGrammar = document.getElementById('statGrammar');
            const statConjugation = document.getElementById('statConjugation');
            const statSpelling = document.getElementById('statSpelling');
            const statStyle = document.getElementById('statStyle');

            // State
            let corrections = [];
            let currentLang = 'en';
            
            // Initialize
            updateLanguageDisplay();
            processText();

            // Event Listeners
            languageSelect.addEventListener('change', updateLanguageDisplay);
            originalText.addEventListener('input', debounce(processText, 500));
            correctBtn.addEventListener('click', processText);
            clearBtn.addEventListener('click', clearAll);
            copyBtn.addEventListener('click', copyCorrectedText);

            // Tooltip handling
            document.addEventListener('mousemove', handleTooltip);
            originalText.addEventListener('mouseout', () => {
                tooltip.classList.remove('show');
            });

            // Functions
            function updateLanguageDisplay() {
                const langText = languageSelect.options[languageSelect.selectedIndex].text;
                currentLanguage.textContent = `Current Language: ${langText}`;
                currentLang = languageSelect.value.startsWith('en') ? 'en' : 'fr';
                processText();
            }

            function clearAll() {
                originalText.innerHTML = '';
                correctedText.innerHTML = '';
                corrections = [];
                updateStats(0, 0, 0, 0, 0, 0);
                showMessage('All text cleared!', 'success');
            }

            function processText() {
                const text = originalText.innerText.trim();
                if (text.length === 0) {
                    correctedText.innerHTML = '';
                    updateStats(0, 0, 0, 0, 0, 0);
                    return;
                }

                loading.classList.add('active');
                
                setTimeout(() => {
                    const corrected = correctEverything(text, currentLang);
                    applyCorrections(text, corrected);
                    loading.classList.remove('active');
                }, 800);
            }

            function correctEverything(text, lang) {
                corrections = [];
                let corrected = text;
                const stats = { grammar: 0, conjugation: 0, spelling: 0, style: 0 };
                
                if (lang === 'en') {
                    // ENGLISH CORRECTIONS
                    
                    // 1. CONJUGATION ERRORS
                    const conjugationRules = [
                        // Present simple - 3rd person singular
                        { pattern: /\b(I|you|we|they)\s+(goes)\b/gi, correction: '$1 go', type: 'conjugation' },
                        { pattern: /\b(I|you|we|they)\s+(has)\b/gi, correction: '$1 have', type: 'conjugation' },
                        { pattern: /\b(I|you|we|they)\s+(does)\b/gi, correction: '$1 do', type: 'conjugation' },
                        { pattern: /\b(I|you|we|they)\s+(was)\b/gi, correction: '$1 were', type: 'conjugation' },
                        { pattern: /\b(he|she|it)\s+(go)\b/gi, correction: '$1 goes', type: 'conjugation' },
                        { pattern: /\b(he|she|it)\s+(have)\b/gi, correction: '$1 has', type: 'conjugation' },
                        { pattern: /\b(he|she|it)\s+(do)\b/gi, correction: '$1 does', type: 'conjugation' },
                        { pattern: /\b(he|she|it)\s+(were)\b/gi, correction: '$1 was', type: 'conjugation' },
                        
                        // Present continuous
                        { pattern: /\b(I|you|we|they|he|she|it)\s+(is)\s+(\w+ing)\b/gi, correction: (match, p1, p2, p3) => {
                            const beVerb = p1.toLowerCase() === 'i' ? 'am' : 
                                         ['he', 'she', 'it'].includes(p1.toLowerCase()) ? 'is' : 'are';
                            return `${p1} ${beVerb} ${p3}`;
                        }, type: 'conjugation' },
                        
                        // Past simple irregular
                        { pattern: /\b(goed)\b/gi, correction: 'went', type: 'conjugation' },
                        { pattern: /\b(buyed)\b/gi, correction: 'bought', type: 'conjugation' },
                        { pattern: /\b(eated)\b/gi, correction: 'ate', type: 'conjugation' },
                        { pattern: /\b(runned)\b/gi, correction: 'ran', type: 'conjugation' },
                        { pattern: /\b(writed)\b/gi, correction: 'wrote', type: 'conjugation' },
                        { pattern: /\b(speakd?)\b/gi, correction: 'spoke', type: 'conjugation' },
                        { pattern: /\b(drinked)\b/gi, correction: 'drank', type: 'conjugation' },
                        { pattern: /\b(swimmed)\b/gi, correction: 'swam', type: 'conjugation' },
                        { pattern: /\b(breaked)\b/gi, correction: 'broke', type: 'conjugation' },
                        { pattern: /\b(catched)\b/gi, correction: 'caught', type: 'conjugation' },
                        { pattern: /\b(teached)\b/gi, correction: 'taught', type: 'conjugation' },
                        { pattern: /\b(thinked)\b/gi, correction: 'thought', type: 'conjugation' },
                        
                        // Present perfect
                        { pattern: /\b(have|has)\s+(go)\b/gi, correction: '$1 gone', type: 'conjugation' },
                        { pattern: /\b(have|has)\s+(eat)\b/gi, correction: '$1 eaten', type: 'conjugation' },
                        { pattern: /\b(have|has)\s+(write)\b/gi, correction: '$1 written', type: 'conjugation' },
                        { pattern: /\b(have|has)\s+(speak)\b/gi, correction: '$1 spoken', type: 'conjugation' },
                        { pattern: /\b(have|has)\s+(drink)\b/gi, correction: '$1 drunk', type: 'conjugation' },
                        { pattern: /\b(have|has)\s+(swim)\b/gi, correction: '$1 swum', type: 'conjugation' },
                    ];
                    
                    // 2. GRAMMAR ERRORS
                    const grammarRules = [
                        // Subject-verb agreement
                        { pattern: /\b(The [\w\s]+)\s+(are|is)\b/gi, correction: (match, p1, p2) => {
                            const verb = p1.toLowerCase().endsWith('s') ? 'are' : 'is';
                            return `${p1} ${verb}`;
                        }, type: 'grammar' },
                        
                        // Pronoun errors
                        { pattern: /\b(him|her)\s+and\s+(I|me)\b/gi, correction: '$2 and I', type: 'grammar' },
                        { pattern: /\b(I|me)\s+and\s+(him|her)\b/gi, correction: '$2 and I', type: 'grammar' },
                        { pattern: /\b(me)\s+(am|is|are|was|were)\b/gi, correction: 'I $2', type: 'grammar' },
                        { pattern: /\b(him|her)\s+(is|are)\b/gi, correction: 'he $2', type: 'grammar' },
                        
                        // Double subject
                        { pattern: /\b(\w+)\s+(\w+)\s+(he|she|it|they|we)\s+(is|are|was|were)\b/gi, 
                          correction: (match, p1, p2, p3, p4) => `${p1} ${p2} ${p4}`, type: 'grammar' },
                        
                        // Don't/doesn't
                        { pattern: /\b(I|you|we|they)\s+(doesn't|does not)\b/gi, correction: '$1 don\'t', type: 'grammar' },
                        { pattern: /\b(he|she|it)\s+(don't|do not)\b/gi, correction: '$1 doesn\'t', type: 'grammar' },
                        
                        // There/their/they're
                        { pattern: /\btheir\b/gi, correction: (match, offset, string) => {
                            const nextWord = string.slice(offset + match.length).split(/\s+/)[0];
                            return /^(is|are|was|were|will|can|should)/i.test(nextWord) ? 'there' : 'their';
                        }, type: 'grammar' },
                        
                        // Your/you're
                        { pattern: /\byour\b/gi, correction: (match, offset, string) => {
                            const nextWord = string.slice(offset + match.length).split(/\s+/)[0];
                            return /^(welcome|going|coming|leaving)/i.test(nextWord) ? 'you\'re' : 'your';
                        }, type: 'grammar' },
                        
                        // Its/it's
                        { pattern: /\bits\b/gi, correction: (match, offset, string) => {
                            const nextWord = string.slice(offset + match.length).split(/\s+/)[0];
                            return /^(a|an|the|my|your|his|her|our|their|not)/i.test(nextWord) ? 'it\'s' : 'its';
                        }, type: 'grammar' },
                    ];
                    
                    // 3. SPELLING ERRORS
                    const spellingRules = [
                        { pattern: /\bdefinately\b/gi, correction: 'definitely', type: 'spelling' },
                        { pattern: /\bseperate\b/gi, correction: 'separate', type: 'spelling' },
                        { pattern: /\boccured\b/gi, correction: 'occurred', type: 'spelling' },
                        { pattern: /\brecieve\b/gi, correction: 'receive', type: 'spelling' },
                        { pattern: /\bwierd\b/gi, correction: 'weird', type: 'spelling' },
                        { pattern: /\bachieve\b/gi, correction: 'achieve', type: 'spelling' },
                        { pattern: /\bgrammer\b/gi, correction: 'grammar', type: 'spelling' },
                        { pattern: /\barguement\b/gi, correction: 'argument', type: 'spelling' },
                        { pattern: /\bjudgement\b/gi, correction: 'judgment', type: 'spelling' },
                        { pattern: /\bliscence\b/gi, correction: 'license', type: 'spelling' },
                        { pattern: /\bmilenium\b/gi, correction: 'millennium', type: 'spelling' },
                        { pattern: /\bneccessary\b/gi, correction: 'necessary', type: 'spelling' },
                        { pattern: /\bpronounciation\b/gi, correction: 'pronunciation', type: 'spelling' },
                        { pattern: /\bpublicher\b/gi, correction: 'publisher', type: 'spelling' },
                    ];
                    
                    // 4. STYLE IMPROVEMENTS
                    const styleRules = [
                        { pattern: /\bvery good\b/gi, correction: 'excellent', type: 'style' },
                        { pattern: /\bvery bad\b/gi, correction: 'terrible', type: 'style' },
                        { pattern: /\ba lot of\b/gi, correction: 'many', type: 'style' },
                        { pattern: /\blots of\b/gi, correction: 'numerous', type: 'style' },
                        { pattern: /\bget\b/gi, correction: 'obtain', type: 'style' },
                        { pattern: /\bgive\b/gi, correction: 'provide', type: 'style' },
                        { pattern: /\bshow\b/gi, correction: 'demonstrate', type: 'style' },
                        { pattern: /\btell\b/gi, correction: 'inform', type: 'style' },
                        { pattern: /\bstart\b/gi, correction: 'begin', type: 'style' },
                        { pattern: /\bend\b/gi, correction: 'conclude', type: 'style' },
                        { pattern: /\btry\b/gi, correction: 'attempt', type: 'style' },
                        { pattern: /\bbuy\b/gi, correction: 'purchase', type: 'style' },
                        { pattern: /\buse\b/gi, correction: 'utilize', type: 'style' },
                        { pattern: /\bhelp\b/gi, correction: 'assist', type: 'style' },
                        { pattern: /\bneed\b/gi, correction: 'require', type: 'style' },
                        { pattern: /\bwant\b/gi, correction: 'desire', type: 'style' },
                    ];
                    
                    // Apply all rules
                    const allRules = [...conjugationRules, ...grammarRules, ...spellingRules, ...styleRules];
                    allRules.forEach(rule => {
                        const regex = new RegExp(rule.pattern.source, 'gi');
                        corrected = corrected.replace(regex, (match, ...args) => {
                            const correction = typeof rule.correction === 'function' 
                                ? rule.correction(match, ...args) 
                                : rule.correction;
                            
                            if (match !== correction) {
                                corrections.push({
                                    from: match,
                                    to: correction,
                                    type: rule.type
                                });
                                stats[rule.type]++;
                            }
                            return correction;
                        });
                    });
                    
                } else {
                    // FRENCH CORRECTIONS
                    
                    // 1. CONJUGAISON (CONJUGATION)
                    const conjugationRulesFR = [
                        // √ätre - pr√©sent
                        { pattern: /\bje\s+est\b/gi, correction: 'je suis', type: 'conjugation' },
                        { pattern: /\btu\s+est\b/gi, correction: 'tu es', type: 'conjugation' },
                        { pattern: /\bil\s+est\b/gi, correction: 'il est', type: 'conjugation' },
                        { pattern: /\belle\s+est\b/gi, correction: 'elle est', type: 'conjugation' },
                        { pattern: /\bnous\s+est\b/gi, correction: 'nous sommes', type: 'conjugation' },
                        { pattern: /\bvous\s+est\b/gi, correction: 'vous √™tes', type: 'conjugation' },
                        { pattern: /\bils\s+est\b/gi, correction: 'ils sont', type: 'conjugation' },
                        { pattern: /\belles\s+est\b/gi, correction: 'elles sont', type: 'conjugation' },
                        
                        // Avoir - pr√©sent
                        { pattern: /\bje\s+avais\b/gi, correction: 'j\'ai', type: 'conjugation' },
                        { pattern: /\btu\s+avais\b/gi, correction: 'tu as', type: 'conjugation' },
                        { pattern: /\bil\s+avais\b/gi, correction: 'il a', type: 'conjugation' },
                        { pattern: /\bnous\s+avais\b/gi, correction: 'nous avons', type: 'conjugation' },
                        { pattern: /\bvous\s+avais\b/gi, correction: 'vous avez', type: 'conjugation' },
                        { pattern: /\bils\s+avais\b/gi, correction: 'ils ont', type: 'conjugation' },
                        
                        // Aller - pr√©sent
                        { pattern: /\bje\s+aller\b/gi, correction: 'je vais', type: 'conjugation' },
                        { pattern: /\btu\s+aller\b/gi, correction: 'tu vas', type: 'conjugation' },
                        { pattern: /\bil\s+aller\b/gi, correction: 'il va', type: 'conjugation' },
                        { pattern: /\bnous\s+aller\b/gi, correction: 'nous allons', type: 'conjugation' },
                        { pattern: /\bvous\s+aller\b/gi, correction: 'vous allez', type: 'conjugation' },
                        { pattern: /\bils\s+aller\b/gi, correction: 'ils vont', type: 'conjugation' },
                        
                        // Manger - pr√©sent
                        { pattern: /\bje\s+mange\b/gi, correction: 'je mange', type: 'conjugation' },
                        { pattern: /\btu\s+mange\b/gi, correction: 'tu manges', type: 'conjugation' },
                        { pattern: /\bil\s+mange\b/gi, correction: 'il mange', type: 'conjugation' },
                        { pattern: /\bnous\s+mange\b/gi, correction: 'nous mangeons', type: 'conjugation' },
                        { pattern: /\bvous\s+mange\b/gi, correction: 'vous mangez', type: 'conjugation' },
                        { pattern: /\bils\s+mange\b/gi, correction: 'ils mangent', type: 'conjugation' },
                        
                        // Parler - pr√©sent
                        { pattern: /\bje\s+parle\b/gi, correction: 'je parle', type: 'conjugation' },
                        { pattern: /\btu\s+parle\b/gi, correction: 'tu parles', type: 'conjugation' },
                        { pattern: /\bil\s+parle\b/gi, correction: 'il parle', type: 'conjugation' },
                        { pattern: /\bnous\s+parle\b/gi, correction: 'nous parlons', type: 'conjugation' },
                        { pattern: /\bvous\s+parle\b/gi, correction: 'vous parlez', type: 'conjugation' },
                        { pattern: /\bils\s+parle\b/gi, correction: 'ils parlent', type: 'conjugation' },
                        
                        // Pass√© compos√© avec avoir
                        { pattern: /\bj[']?ai\s+(manger|parler|regarder)\b/gi, correction: (match, p1) => `j'ai ${p1}√©`, type: 'conjugation' },
                        { pattern: /\btu as\s+(manger|parler|regarder)\b/gi, correction: (match, p1) => `tu as ${p1}√©`, type: 'conjugation' },
                        { pattern: /\bil a\s+(manger|parler|regarder)\b/gi, correction: (match, p1) => `il a ${p1}√©`, type: 'conjugation' },
                        { pattern: /\bnous avons\s+(manger|parler|regarder)\b/gi, correction: (match, p1) => `nous avons ${p1}√©`, type: 'conjugation' },
                        
                        // N√©gation
                        { pattern: /\bil parle pas\b/gi, correction: 'il ne parle pas', type: 'conjugation' },
                        { pattern: /\bje sais pas\b/gi, correction: 'je ne sais pas', type: 'conjugation' },
                        { pattern: /\btu veux pas\b/gi, correction: 'tu ne veux pas', type: 'conjugation' },
                    ];
                    
                    // 2. GRAMMAIRE (GRAMMAR)
                    const grammarRulesFR = [
                        // Accords
                        { pattern: /\bLes pommes √©tait\b/gi, correction: 'Les pommes √©taient', type: 'grammar' },
                        { pattern: /\bLes enfants est\b/gi, correction: 'Les enfants sont', type: 'grammar' },
                        { pattern: /\bLa maison sont\b/gi, correction: 'La maison est', type: 'grammar' },
                        { pattern: /\bLes voitures est\b/gi, correction: 'Les voitures sont', type: 'grammar' },
                        
                        // Genre
                        { pattern: /\bune ami\b/gi, correction: 'un ami', type: 'grammar' },
                        { pattern: /\bun amie\b/gi, correction: 'une amie', type: 'grammar' },
                        { pattern: /\ble table\b/gi, correction: 'la table', type: 'grammar' },
                        { pattern: /\bla livre\b/gi, correction: 'le livre', type: 'grammar' },
                        
                        // Pronoms
                        { pattern: /\bmoi et\b/gi, correction: 'et moi', type: 'grammar' },
                        { pattern: /\btoi et\b/gi, correction: 'et toi', type: 'grammar' },
                        { pattern: /\blui et\b/gi, correction: 'et lui', type: 'grammar' },
                        { pattern: /\belle et\b/gi, correction: 'et elle', type: 'grammar' },
                    ];
                    
                    // 3. ORTHOGRAPHE (SPELLING)
                    const spellingRulesFR = [
                        // Accents manquants
                        { pattern: /\bapres\b/gi, correction: 'apr√®s', type: 'spelling' },
                        { pattern: /\bquand\b/gi, correction: 'quand', type: 'spelling' },
                        { pattern: /\bjusqu'a\b/gi, correction: 'jusqu\'√†', type: 'spelling' },
                        { pattern: /\bcote\b/gi, correction: 'c√¥te', type: 'spelling' },
                        { pattern: /\btache\b/gi, correction: 't√¢che', type: 'spelling' },
                        { pattern: /\betre\b/gi, correction: '√™tre', type: 'spelling' },
                        { pattern: /\bfacade\b/gi, correction: 'fa√ßade', type: 'spelling' },
                        { pattern: /\beleve\b/gi, correction: '√©l√®ve', type: 'spelling' },
                        { pattern: /\bhotel\b/gi, correction: 'h√¥tel', type: 'spelling' },
                        { pattern: /\bile\b/gi, correction: '√Æle', type: 'spelling' },
                        { pattern: /\bnoel\b/gi, correction: 'No√´l', type: 'spelling' },
                        { pattern: /\btete\b/gi, correction: 't√™te', type: 'spelling' },
                        
                        // Doubles consonnes
                        { pattern: /\bapeller\b/gi, correction: 'appeler', type: 'spelling' },
                        { pattern: /\batention\b/gi, correction: 'attention', type: 'spelling' },
                        { pattern: /\bcomun\b/gi, correction: 'commun', type: 'spelling' },
                        { pattern: /\bdiferent\b/gi, correction: 'diff√©rent', type: 'spelling' },
                        { pattern: /\binteressant\b/gi, correction: 'int√©ressant', type: 'spelling' },
                        { pattern: /\bnecesaire\b/gi, correction: 'n√©cessaire', type: 'spelling' },
                        { pattern: /\bocasion\b/gi, correction: 'occasion', type: 'spelling' },
                    ];
                    
                    // 4. STYLE
                    const styleRulesFR = [
                        { pattern: /\btr√®s bon\b/gi, correction: 'excellent', type: 'style' },
                        { pattern: /\btr√®s mauvais\b/gi, correction: 'd√©plorable', type: 'style' },
                        { pattern: /\bbeaucoup de\b/gi, correction: 'nombreux', type: 'style' },
                        { pattern: /\bdonner\b/gi, correction: 'fournir', type: 'style' },
                        { pattern: /\bmontrer\b/gi, correction: 'd√©montrer', type: 'style' },
                        { pattern: /\bdire\b/gi, correction: 'informer', type: 'style' },
                        { pattern: /\bcommencer\b/gi, correction: 'd√©buter', type: 'style' },
                        { pattern: /\bfinir\b/gi, correction: 'terminer', type: 'style' },
                        { pattern: /\bessayer\b/gi, correction: 'tenter', type: 'style' },
                        { pattern: /\bacheter\b/gi, correction: 'acqu√©rir', type: 'style' },
                    ];
                    
                    // Apply all French rules
                    const allRulesFR = [...conjugationRulesFR, ...grammarRulesFR, ...spellingRulesFR, ...styleRulesFR];
                    allRulesFR.forEach(rule => {
                        const regex = new RegExp(rule.pattern.source, 'gi');
                        corrected = corrected.replace(regex, (match, ...args) => {
                            const correction = typeof rule.correction === 'function' 
                                ? rule.correction(match, ...args) 
                                : rule.correction;
                            
                            if (match !== correction) {
                                corrections.push({
                                    from: match,
                                    to: correction,
                                    type: rule.type
                                });
                                stats[rule.type]++;
                            }
                            return correction;
                        });
                    });
                }
                
                // Fix punctuation and capitalization
                corrected = corrected.replace(/\s+([.,!?;:])/g, '$1');
                corrected = corrected.replace(/([.,!?;:])(\w)/g, '$1 $2');
                corrected = corrected.replace(/\s{2,}/g, ' ');
                corrected = corrected.replace(/^(\w)/, (match) => match.toUpperCase());
                corrected = corrected.replace(/([.!?]\s+)(\w)/g, (match, p1, p2) => p1 + p2.toUpperCase());
                
                if (lang === 'en') {
                    corrected = corrected.replace(/\bi\b/g, 'I');
                }
                
                return corrected;
            }

            function applyCorrections(original, corrected) {
                // Highlight errors in original text
                let highlighted = original;
                corrections.forEach(correction => {
                    const escapedFrom = escapeRegExp(correction.from);
                    const regex = new RegExp(`(${escapedFrom})`, 'gi');
                    highlighted = highlighted.replace(regex, 
                        `<span class="error-highlight" 
                              data-from="${correction.from}" 
                              data-to="${correction.to}"
                              data-type="${correction.type}">
                            $1
                            <span class="error-marker">‚ö†Ô∏è</span>
                         </span>`);
                });
                
                originalText.innerHTML = highlighted;
                
                // Format corrected text with highlights
                let formattedCorrected = corrected;
                corrections.forEach(correction => {
                    const escapedTo = escapeRegExp(correction.to);
                    const regex = new RegExp(`(${escapedTo})`, 'gi');
                    formattedCorrected = formattedCorrected.replace(regex, 
                        `<span class="${correction.type === 'style' ? 'improved-word' : 'corrected-word'}" 
                              title="Corrected from: ${correction.from}">
                            $1
                         </span>`);
                });
                
                correctedText.innerHTML = formattedCorrected.replace(/\n/g, '<br>');
                
                // Update stats
                const words = original.trim() === '' ? 0 : original.trim().split(/\s+/).length;
                const errors = corrections.length;
                
                errorCount.textContent = errors;
                originalErrorCount.textContent = errors;
                wordCount.textContent = words;
                charCount.textContent = corrected.length;
                correctionCount.textContent = errors;
                correctedCount.textContent = errors;
                
                errorCountBadge.innerHTML = `${errors} ${errors === 1 ? 'error' : 'errors'}`;
                correctionCountBadge.innerHTML = `${errors} ${errors === 1 ? 'correction' : 'corrections'}`;
                
                // Calculate detailed stats
                const grammarCount = corrections.filter(c => c.type === 'grammar').length;
                const conjugationCount = corrections.filter(c => c.type === 'conjugation').length;
                const spellingCount = corrections.filter(c => c.type === 'spelling').length;
                const styleCount = corrections.filter(c => c.type === 'style').length;
                
                statWords.textContent = words;
                statErrors.textContent = errors;
                statGrammar.textContent = grammarCount;
                statConjugation.textContent = conjugationCount;
                statSpelling.textContent = spellingCount;
                statStyle.textContent = styleCount;
                
                if (errors > 0) {
                    showMessage(`‚úÖ Corrected ${errors} errors!`, 'success');
                }
            }

            function handleTooltip(e) {
                const target = e.target;
                if (target.classList.contains('error-highlight')) {
                    const from = target.getAttribute('data-from');
                    const to = target.getAttribute('data-to');
                    const type = target.getAttribute('data-type');
                    
                    const typeMap = {
                        'grammar': 'Grammar Error',
                        'conjugation': 'Conjugation Error',
                        'spelling': 'Spelling Error',
                        'style': 'Style Improvement'
                    };
                    
                    tooltip.innerHTML = `
                        <strong>${typeMap[type] || 'Error'}</strong>
                        <div style="margin: 8px 0; color: #FFA000;">"${from}"</div>
                        <div>‚Üí <span class="suggestion">"${to}"</span></div>
                    `;
                    
                    tooltip.style.left = e.pageX + 15 + 'px';
                    tooltip.style.top = e.pageY + 15 + 'px';
                    tooltip.classList.add('show');
                } else {
                    tooltip.classList.remove('show');
                }
            }

            async function copyCorrectedText() {
                const text = correctedText.innerText;
                if (!text.trim()) {
                    showMessage('Please correct some text first', 'error');
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(text);
                    showMessage('‚úÖ Corrected text copied!', 'success');
                } catch (err) {
                    showMessage('Failed to copy text', 'error');
                }
            }

            function showMessage(text, type = 'success') {
                message.textContent = text;
                message.className = `message ${type}`;
                message.classList.add('show');
                
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
            }

            function updateStats(words, errors, grammar, conjugation, spelling, style) {
                statWords.textContent = words;
                statErrors.textContent = errors;
                statGrammar.textContent = grammar;
                statConjugation.textContent = conjugation;
                statSpelling.textContent = spelling;
                statStyle.textContent = style;
            }

            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        });
    </script>
</body>
</html>
