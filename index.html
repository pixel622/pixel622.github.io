<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pixel Pok√©mon Mobile Fan Game</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
}

canvas{
    display:block;
    image-rendering: pixelated;
}

/* JOYSTICK */
#joystickBase{
    position:fixed;
    left:40px;
    bottom:40px;
    width:140px;
    height:140px;
    border-radius:50%;
    background:rgba(255,255,255,0.2);
}

#joystickKnob{
    position:absolute;
    left:40px;
    top:40px;
    width:60px;
    height:60px;
    border-radius:50%;
    background:rgba(255,255,255,0.6);
}

/* BUTTONS */
.btn{
    position:fixed;
    width:70px;
    height:70px;
    border-radius:50%;
    background:rgba(255,255,255,0.3);
    color:white;
    font-size:14px;
    text-align:center;
    line-height:70px;
    user-select:none;
}

#btnA{ right:40px; bottom:60px; }
#btnB{ right:130px; bottom:140px; }
#btnMenu{ right:40px; top:40px; }
#btnBag{ right:130px; top:40px; }

#battleUI{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    height:40%;
    background:#222;
    display:none;
    color:white;
    font-family:sans-serif;
}
.moveBtn{
    width:45%;
    height:40%;
    margin:2%;
    background:#444;
    display:inline-block;
    text-align:center;
    line-height:70px;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<!-- JOYSTICK -->
<div id="joystickBase">
    <div id="joystickKnob"></div>
</div>

<!-- BUTTONS -->
<div id="btnA" class="btn">A</div>
<div id="btnB" class="btn">B</div>
<div id="btnMenu" class="btn">Menu</div>
<div id="btnBag" class="btn">Bag</div>

<!-- BATTLE UI -->
<div id="battleUI">
    <div class="moveBtn" onclick="playerAttack(0)">Move 1</div>
    <div class="moveBtn" onclick="playerAttack(1)">Move 2</div>
    <div class="moveBtn" onclick="playerAttack(2)">Move 3</div>
    <div class="moveBtn" onclick="playerAttack(3)">Move 4</div>
</div>

<script>

/* CANVAS SETUP */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* GAME STATE */

let gameState = "world";

/* TILE MAP */

const tileSize = 32;
const mapWidth = 30;
const mapHeight = 20;

let map = [];

for(let y=0;y<mapHeight;y++){
    let row=[];
    for(let x=0;x<mapWidth;x++){

        if(Math.random()<0.2) row.push("grass");
        else row.push("ground");

    }
    map.push(row);
}

/* PLAYER */

let player = {
    x:200,
    y:200,
    speed:2,
    runSpeed:4,
    dirX:0,
    dirY:0,
    pokemon:{
        name:"Pikachu",
        hp:35,
        maxHp:35,
        moves:["Thunder Shock","Quick Attack","Tail Whip","Growl"]
    }
};

/* JOYSTICK */

const base = document.getElementById("joystickBase");
const knob = document.getElementById("joystickKnob");

let joy = {x:0,y:0};
let dragging=false;

base.addEventListener("touchstart",()=>dragging=true);
document.addEventListener("touchend",()=>{
    dragging=false;
    joy.x=0; joy.y=0;
    knob.style.left="40px";
    knob.style.top="40px";
});

document.addEventListener("touchmove",e=>{
    if(!dragging) return;

    let rect = base.getBoundingClientRect();
    let touch = e.touches[0];

    let dx = touch.clientX - (rect.left+70);
    let dy = touch.clientY - (rect.top+70);

    let dist = Math.sqrt(dx*dx+dy*dy);
    let max = 50;

    if(dist>max){
        dx*=max/dist;
        dy*=max/dist;
    }

    knob.style.left = (dx+40)+"px";
    knob.style.top = (dy+40)+"px";

    joy.x = dx/max;
    joy.y = dy/max;
});

/* BUTTON EVENTS */

document.getElementById("btnA").onclick = ()=>interact();
document.getElementById("btnB").onclick = ()=>back();

/* WORLD DRAW */

function drawMap(){

    for(let y=0;y<mapHeight;y++){
        for(let x=0;x<mapWidth;x++){

            if(map[y][x]=="grass"){
                ctx.fillStyle="green";
            } else{
                ctx.fillStyle="#8BC34A";
            }

            ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);
        }
    }
}

/* PLAYER DRAW */

function drawPlayer(){
    ctx.fillStyle="yellow";
    ctx.fillRect(player.x,player.y,24,24);
}

/* MOVEMENT */

function updatePlayer(){

    let speed = Math.abs(joy.x)+Math.abs(joy.y)>1 ? player.runSpeed : player.speed;

    player.x += joy.x*speed;
    player.y += joy.y*speed;

    checkWildEncounter();
}

/* WILD ENCOUNTER */

function checkWildEncounter(){

    let tileX = Math.floor(player.x/tileSize);
    let tileY = Math.floor(player.y/tileSize);

    if(map[tileY] && map[tileY][tileX]=="grass"){

        if(Math.random()<0.01){
            startBattle();
        }

    }
}

/* BATTLE SYSTEM */

let enemyPokemon=null;

function startBattle(){

    gameState="battle";

    enemyPokemon={
        name:"Bulbasaur",
        hp:40,
        maxHp:40
    };

    document.getElementById("battleUI").style.display="block";
}

function playerAttack(index){

    if(gameState!=="battle") return;

    enemyPokemon.hp -= 10;

    if(enemyPokemon.hp<=0){
        endBattle();
    }else{
        player.pokemon.hp -= 5;
    }
}

function endBattle(){
    document.getElementById("battleUI").style.display="none";
    gameState="world";
}

/* INTERACT */

function interact(){
    alert("Interacting with world!");
}

function back(){
    alert("Back pressed");
}

/* SAVE SYSTEM */

function saveGame(){
    localStorage.setItem("pokeSave",JSON.stringify(player));
}

function loadGame(){
    let save = localStorage.getItem("pokeSave");
    if(save) player = JSON.parse(save);
}
loadGame();

setInterval(saveGame,5000);

/* MAIN LOOP */

function gameLoop(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(gameState=="world"){
        drawMap();
        updatePlayer();
        drawPlayer();
    }

    if(gameState=="battle"){
        ctx.fillStyle="black";
        ctx.fillRect(0,0,canvas.width,canvas.height);

        ctx.fillStyle="white";
        ctx.fillText(player.pokemon.name+" HP: "+player.pokemon.hp,50,50);
        ctx.fillText(enemyPokemon.name+" HP: "+enemyPokemon.hp,50,100);
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();

</script>
</body>
</html>
