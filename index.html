<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Text Detector with Highlighting</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #b0b0b0;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #00dbde;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h2 i {
            font-size: 1.5rem;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #302b63;
            border-radius: 10px;
            padding: 15px;
            color: #f0f0f0;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
            border-color: #00dbde;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            background: linear-gradient(90deg, #302b63, #24243e);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 160px;
            justify-content: center;
        }
        
        button:hover {
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 219, 222, 0.4);
        }
        
        /* New Text Highlighting Section */
        .highlight-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .highlight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .highlight-title {
            font-size: 1.2rem;
            color: #00dbde;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .highlight-legend {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .ai-color {
            background: linear-gradient(90deg, #fc00ff, #b300b3);
        }
        
        .human-color {
            background: linear-gradient(90deg, #00dbde, #0099cc);
        }
        
        .highlighted-text-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            line-height: 1.6;
            font-size: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .highlighted-text {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .ai-highlight {
            background-color: rgba(252, 0, 255, 0.25);
            border-bottom: 2px solid #fc00ff;
            padding: 1px 3px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .ai-highlight:hover {
            background-color: rgba(252, 0, 255, 0.4);
            box-shadow: 0 0 5px rgba(252, 0, 255, 0.5);
        }
        
        .human-highlight {
            background-color: rgba(0, 219, 222, 0.25);
            border-bottom: 2px solid #00dbde;
            padding: 1px 3px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .human-highlight:hover {
            background-color: rgba(0, 219, 222, 0.4);
            box-shadow: 0 0 5px rgba(0, 219, 222, 0.5);
        }
        
        .neutral-text {
            padding: 1px 3px;
        }
        
        .result-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 25px 0;
        }
        
        .chart-container {
            width: 100%;
            height: 250px;
            margin-bottom: 20px;
        }
        
        .score-display {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .score-box {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .ai-score {
            color: #fc00ff;
        }
        
        .human-score {
            color: #00dbde;
        }
        
        .confidence-level {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a00, #ffcc00);
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease-out;
        }
        
        .suggestions {
            margin-top: 20px;
        }
        
        .suggestion-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #00dbde;
            transition: transform 0.3s;
        }
        
        .suggestion-item:hover {
            transform: translateX(5px);
        }
        
        .suggestion-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            color: #00dbde;
            font-weight: 600;
        }
        
        .analysis-details {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-size: 0.9rem;
            color: #b0b0b0;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .detail-value {
            font-weight: bold;
            color: #00dbde;
        }
        
        .red-flag {
            color: #ff6b6b;
        }
        
        .green-flag {
            color: #51cf66;
        }
        
        .yellow-flag {
            color: #ffd43b;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
        }
        
        .sample-texts {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .sample-btn {
            background: rgba(48, 43, 99, 0.5);
            border: 1px solid #302b63;
            padding: 8px 15px;
            border-radius: 6px;
            color: #b0b0b0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .sample-btn:hover {
            background: rgba(0, 219, 222, 0.2);
            color: #00dbde;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .score-display {
                flex-direction: column;
                align-items: center;
            }
            
            .score-box {
                width: 100%;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .highlight-legend {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> Advanced AI Text Detector</h1>
            <p class="subtitle">Paste your text below for consistent AI detection analysis with highlighted AI and human sections.</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <h2><i class="fas fa-keyboard"></i> Input Text</h2>
                
                <div class="sample-texts">
                    <button class="sample-btn" data-sample="ai">AI-Generated Sample</button>
                    <button class="sample-btn" data-sample="human">Human-Written Sample</button>
                    <button class="sample-btn" data-sample="mixed">Mixed Content Sample</button>
                </div>
                
                <textarea id="inputText" placeholder="Paste or type your text here for analysis...">Artificial Intelligence (AI) has become an increasingly significant field of study in recent years, with applications ranging from simple automation to complex decision-making systems. The fundamental premise of AI is to develop machines that can perform tasks typically requiring human intelligence, such as visual perception, speech recognition, and language translation.

Machine learning, a subset of AI, employs algorithms that enable computers to learn from and make predictions based on data. These algorithms identify patterns within datasets and utilize these patterns to make informed decisions without explicit programming for each specific task. Deep learning, a further subset of machine learning, utilizes neural networks with multiple layers to process data in increasingly abstract ways.

The ethical implications of AI development have become a topic of considerable discussion among researchers and policymakers. Concerns include algorithmic bias, job displacement due to automation, and the potential for autonomous systems to make decisions with significant real-world consequences. Consequently, many organizations are developing guidelines for responsible AI implementation.</textarea>
                
                <div class="buttons">
                    <button id="analyzeBtn">
                        <i class="fas fa-search"></i> Analyze Text
                    </button>
                    <button id="clearBtn">
                        <i class="fas fa-eraser"></i> Clear Text
                    </button>
                    <button id="saveBtn">
                        <i class="fas fa-save"></i> Save Analysis
                    </button>
                </div>
                
                <!-- New Text Highlighting Section -->
                <div class="highlight-section">
                    <div class="highlight-header">
                        <div class="highlight-title">
                            <i class="fas fa-highlighter"></i>
                            <span>Text Analysis Breakdown</span>
                        </div>
                        <div class="highlight-legend">
                            <div class="legend-item">
                                <div class="legend-color ai-color"></div>
                                <span>AI-Generated</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color human-color"></div>
                                <span>Human-Written</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="highlighted-text-container">
                        <div class="highlighted-text" id="highlightedText">
                            <div style="text-align: center; padding: 40px; color: #888;">
                                <i class="fas fa-highlighter fa-2x" style="margin-bottom: 15px; display: block;"></i>
                                <p>Your text will appear here with AI parts highlighted in purple and human parts in blue after analysis.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-details">
                    <p><i class="fas fa-info-circle"></i> This detector analyzes: Sentence structure, vocabulary diversity, word patterns, readability scores, and linguistic features to provide consistent AI detection results.</p>
                </div>
            </div>
            
            <div class="result-section">
                <div class="panel">
                    <h2><i class="fas fa-chart-pie"></i> Detection Results</h2>
                    
                    <div class="result-display">
                        <div class="chart-container">
                            <canvas id="detectionChart"></canvas>
                        </div>
                        
                        <div class="score-display">
                            <div class="score-box">
                                <div class="score-value ai-score" id="aiPercentage">0%</div>
                                <div>AI-Generated</div>
                            </div>
                            
                            <div class="score-box">
                                <div class="score-value human-score" id="humanPercentage">0%</div>
                                <div>Human-Written</div>
                            </div>
                        </div>
                        
                        <div class="confidence-level">
                            <span>Analysis Confidence:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill"></div>
                            </div>
                            <span id="confidenceValue">0%</span>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <span>Words Analyzed:</span>
                        <span class="detail-value" id="wordCount">0</span>
                    </div>
                    <div class="detail-row">
                        <span>Readability Score:</span>
                        <span class="detail-value" id="readabilityScore">0</span>
                    </div>
                    <div class="detail-row">
                        <span>Sentence Variation:</span>
                        <span class="detail-value" id="sentenceVariation">0%</span>
                    </div>
                    <div class="detail-row">
                        <span>Vocabulary Diversity:</span>
                        <span class="detail-value" id="vocabDiversity">0%</span>
                    </div>
                </div>
                
                <div class="panel suggestions">
                    <h2><i class="fas fa-lightbulb"></i> Suggestions to Humanize</h2>
                    
                    <div id="suggestionsList">
                        <div class="suggestion-item">
                            <div class="suggestion-title">
                                <i class="fas fa-exclamation-circle"></i>
                                <span>Analyze text to get suggestions</span>
                            </div>
                            <p>Click "Analyze Text" to see specific recommendations for making your content sound more natural and human-like.</p>
                        </div>
                    </div>
                    
                    <div class="analysis-details" style="margin-top: 20px;">
                        <p><strong>AI Detection Factors:</strong></p>
                        <p>• <span class="red-flag">Red flags:</span> Repetitive structures, formal tone, lack of pronouns</p>
                        <p>• <span class="green-flag">Human indicators:</span> Personal anecdotes, varied sentence lengths, informal expressions</p>
                        <p>• <span class="yellow-flag">Neutral elements:</span> Technical terms, factual statements, standard grammar</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Advanced AI Detector v2.0 | Analysis is based on linguistic patterns and provides consistent, reproducible results for the same input text.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize variables
            const inputText = document.getElementById('inputText');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const clearBtn = document.getElementById('clearBtn');
            const saveBtn = document.getElementById('saveBtn');
            const aiPercentage = document.getElementById('aiPercentage');
            const humanPercentage = document.getElementById('humanPercentage');
            const confidenceValue = document.getElementById('confidenceValue');
            const confidenceFill = document.getElementById('confidenceFill');
            const wordCount = document.getElementById('wordCount');
            const readabilityScore = document.getElementById('readabilityScore');
            const sentenceVariation = document.getElementById('sentenceVariation');
            const vocabDiversity = document.getElementById('vocabDiversity');
            const suggestionsList = document.getElementById('suggestionsList');
            const sampleButtons = document.querySelectorAll('.sample-btn');
            const highlightedText = document.getElementById('highlightedText');
            
            // Chart initialization
            let detectionChart = null;
            const ctx = document.getElementById('detectionChart').getContext('2d');
            
            // Sample texts
            const sampleTexts = {
                ai: `Artificial intelligence represents a paradigm shift in computational capabilities, enabling machines to perform tasks that traditionally required human cognitive faculties. The development of neural networks, particularly deep learning architectures, has facilitated remarkable progress in domains such as natural language processing, computer vision, and autonomous systems. These systems leverage vast datasets and sophisticated algorithms to identify patterns and generate responses that increasingly approximate human-like understanding. However, the interpretability of AI decision-making processes remains a significant challenge, often described as the "black box" problem in machine learning literature. Researchers continue to explore methods for enhancing transparency and accountability in AI systems to ensure their ethical deployment across various sectors.`,
                
                human: `You know, when I think about AI, it's kind of wild how fast it's all moving. Just a few years ago, my phone could barely understand what I was saying, and now it's writing emails for me! But honestly, it still messes up sometimes - like when it suggests replies that don't even make sense for the conversation. 

I was talking to my friend about her dog the other day, and my keyboard suggested "I'm sorry for your loss" as a response! Her dog is perfectly healthy. These AI tools are getting better, but they still miss the human touch - the little nuances that make conversations feel real. 

What really worries me though is when I can't tell if I'm talking to a person or a bot online. The other day I spent ten minutes chatting with what I thought was a customer service rep, only to realize it was just a really advanced chatbot. It did solve my problem, but the interaction felt... off somehow.`,
                
                mixed: `Artificial intelligence has revolutionized many industries, but its implementation requires careful consideration. From my experience working with AI tools, I've noticed they excel at repetitive tasks but struggle with nuanced human communication.

For instance, GPT-based models can generate coherent text on virtually any topic, yet they often produce content that feels generic or lacks personal insight. In my last project, we used an AI to draft initial reports, but our team had to extensively revise them to include specific case examples and practical recommendations that the AI overlooked.

The key challenge is balancing automation with human oversight. While AI can process data faster than any human, it doesn't understand context in the same way. This is why hybrid approaches - combining AI efficiency with human judgment - tend to yield the best results in real-world applications.`
            };
            
            // Text analysis functions - deterministic (same text = same results)
            function analyzeTextDeterministically(text) {
                if (!text || text.trim().length < 10) {
                    return {
                        aiScore: 0,
                        humanScore: 0,
                        confidence: 0,
                        wordCount: 0,
                        readability: 0,
                        sentenceVariation: 0,
                        vocabDiversity: 0
                    };
                }
                
                // Clean and prepare text
                const cleanText = text.trim();
                const words = cleanText.split(/\s+/);
                const sentences = cleanText.split(/[.!?]+/).filter(s => s.trim().length > 0);
                
                // Word count
                const wordCountValue = words.length;
                
                // 1. Analyze sentence length variation (AI tends to be more uniform)
                const sentenceLengths = sentences.map(s => s.split(/\s+/).length);
                const avgSentenceLength = sentenceLengths.reduce((a, b) => a + b, 0) / sentenceLengths.length;
                const sentenceVariance = sentenceLengths.length > 1 ? 
                    Math.sqrt(sentenceLengths.map(x => Math.pow(x - avgSentenceLength, 2)).reduce((a, b) => a + b, 0) / sentenceLengths.length) / avgSentenceLength : 0;
                
                // Convert to percentage (more variance = more human)
                const sentenceVariationScore = Math.min(100, Math.max(0, sentenceVariance * 500));
                
                // 2. Analyze vocabulary diversity (unique words / total words)
                const uniqueWords = [...new Set(words.map(w => w.toLowerCase().replace(/[^\w]/g, '')))].filter(w => w.length > 0);
                const vocabDiversityScore = Math.min(100, (uniqueWords.length / words.length) * 150);
                
                // 3. Check for AI indicators
                let aiIndicatorScore = 0;
                
                // Common AI phrases
                const aiPhrases = [
                    "it is important to", "as a result", "furthermore", "moreover", 
                    "in addition", "in conclusion", "this essay will", "it can be seen",
                    "it should be noted", "the following", "as previously mentioned"
                ];
                
                const lowerText = cleanText.toLowerCase();
                aiPhrases.forEach(phrase => {
                    if (lowerText.includes(phrase)) aiIndicatorScore += 3;
                });
                
                // Check for repetitive sentence starters
                if (sentences.length > 3) {
                    const firstWords = sentences.map(s => {
                        const firstWord = s.trim().split(/\s+/)[0]?.toLowerCase() || '';
                        return firstWord.replace(/[^\w]/g, '');
                    }).filter(w => w.length > 0);
                    
                    const uniqueStarters = [...new Set(firstWords)];
                    const starterDiversity = uniqueStarters.length / firstWords.length;
                    
                    if (starterDiversity < 0.5) aiIndicatorScore += 15 * (1 - starterDiversity);
                }
                
                // Check for passive voice indicators
                const passiveWords = [" is ", " was ", " were ", " are ", " been ", " being "];
                let passiveCount = 0;
                passiveWords.forEach(word => {
                    const regex = new RegExp(word, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) passiveCount += matches.length;
                });
                
                if (passiveCount > 0) {
                    aiIndicatorScore += Math.min(20, passiveCount * 2);
                }
                
                // Check for lack of personal pronouns (AI often avoids "I", "we", "my")
                const personalPronouns = [" i ", " we ", " my ", " our ", " me ", " us "];
                let pronounCount = 0;
                personalPronouns.forEach(pronoun => {
                    const regex = new RegExp(pronoun, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) pronounCount += matches.length;
                });
                
                // Fewer personal pronouns = more likely AI
                if (pronounCount < 3 && words.length > 100) {
                    aiIndicatorScore += 15;
                }
                
                // Check for overly formal transition words
                const formalTransitions = ["however", "therefore", "consequently", "thus", "hence", "nevertheless"];
                let formalTransitionCount = 0;
                formalTransitions.forEach(word => {
                    const regex = new RegExp(`\\b${word}\\b`, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) formalTransitionCount += matches.length;
                });
                
                aiIndicatorScore += Math.min(10, formalTransitionCount * 2);
                
                // 4. Check for human indicators
                let humanIndicatorScore = 0;
                
                // Check for contractions (human writing uses more contractions)
                const contractions = ["don't", "can't", "won't", "it's", "i'm", "you're", "they're", "we're"];
                let contractionCount = 0;
                contractions.forEach(contraction => {
                    const regex = new RegExp(`\\b${contraction}\\b`, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) contractionCount += matches.length;
                });
                
                humanIndicatorScore += Math.min(15, contractionCount * 3);
                
                // Check for informal expressions
                const informalWords = ["okay", "well", "like", "actually", "basically", "anyway", "honestly", "really"];
                let informalCount = 0;
                informalWords.forEach(word => {
                    const regex = new RegExp(`\\b${word}\\b`, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) informalCount += matches.length;
                });
                
                humanIndicatorScore += Math.min(10, informalCount * 2);
                
                // Check for sentence fragments (humans use them more often)
                const fragments = sentences.filter(s => {
                    const wordsInSentence = s.split(/\s+/).length;
                    return wordsInSentence < 5 && wordsInSentence > 0;
                }).length;
                
                humanIndicatorScore += Math.min(10, fragments * 2);
                
                // Check for questions (humans ask questions more)
                const questionCount = (cleanText.match(/\?/g) || []).length;
                humanIndicatorScore += Math.min(10, questionCount * 2);
                
                // 5. Calculate final scores
                // Base AI score from indicators (0-70 range)
                let finalAiScore = Math.min(70, aiIndicatorScore);
                
                // Adjust based on linguistic features
                // Less sentence variation = more AI
                finalAiScore += (100 - sentenceVariationScore) * 0.15;
                
                // Less vocabulary diversity = more AI
                finalAiScore += (100 - vocabDiversityScore) * 0.15;
                
                // Subtract human indicators
                finalAiScore -= humanIndicatorScore;
                
                // Ensure score is between 0 and 100
                finalAiScore = Math.max(0, Math.min(100, finalAiScore));
                
                // Human score is inverse of AI score
                const finalHumanScore = 100 - finalAiScore;
                
                // Calculate confidence based on text length and score difference
                let confidence = 50 + (Math.min(30, wordCountValue / 10)) + Math.abs(finalAiScore - finalHumanScore) / 2;
                confidence = Math.min(95, Math.max(60, confidence));
                
                // Calculate readability (Flesch-Kincaid approximate)
                const syllables = words.join(' ').length * 0.3; // Approximate
                const readability = Math.max(0, Math.min(100, 206.835 - (1.015 * (words.length / sentences.length)) - (84.6 * (syllables / words.length))));
                
                return {
                    aiScore: Math.round(finalAiScore),
                    humanScore: Math.round(finalHumanScore),
                    confidence: Math.round(confidence),
                    wordCount: wordCountValue,
                    readability: Math.round(readability),
                    sentenceVariation: Math.round(sentenceVariationScore),
                    vocabDiversity: Math.round(vocabDiversityScore)
                };
            }
            
            // NEW FUNCTION: Highlight text with AI and human parts
            function highlightText(text, aiScore) {
                if (!text || text.trim().length === 0) {
                    return '<div style="text-align: center; padding: 40px; color: #888;"><i class="fas fa-highlighter fa-2x" style="margin-bottom: 15px; display: block;"></i><p>Your text will appear here with AI parts highlighted in purple and human parts in blue after analysis.</p></div>';
                }
                
                // Break text into sentences
                const sentences = text.split(/([.!?]+)/);
                let highlightedHTML = '';
                
                // Determine highlight threshold based on overall AI score
                // Higher AI score = more sentences will be highlighted as AI
                const aiThreshold = 50; // Base threshold
                const adjustedThreshold = aiThreshold - (aiScore - 50) / 5;
                
                // Common AI indicators for sentence-level analysis
                const aiIndicators = [
                    "it is important", "furthermore", "moreover", "in addition", 
                    "in conclusion", "as a result", "therefore", "thus", "hence",
                    "consequently", "additionally", "notably", "significantly"
                ];
                
                // Human indicators for sentence-level analysis
                const humanIndicators = [
                    "i think", "i believe", "in my opinion", "from my experience",
                    "actually", "basically", "anyway", "honestly", "really",
                    "kind of", "sort of", "you know", "i mean"
                ];
                
                // Process each sentence
                for (let i = 0; i < sentences.length; i++) {
                    const sentence = sentences[i].trim();
                    if (sentence.length === 0) continue;
                    
                    // Check if this is a punctuation-only segment
                    if (/^[.!?]+$/.test(sentence)) {
                        highlightedHTML += `<span class="neutral-text">${sentence}</span>`;
                        continue;
                    }
                    
                    // Analyze sentence for AI/human indicators
                    const lowerSentence = sentence.toLowerCase();
                    let aiIndicatorCount = 0;
                    let humanIndicatorCount = 0;
                    
                    // Check for AI indicators
                    aiIndicators.forEach(indicator => {
                        if (lowerSentence.includes(indicator)) aiIndicatorCount++;
                    });
                    
                    // Check for human indicators
                    humanIndicators.forEach(indicator => {
                        if (lowerSentence.includes(indicator)) humanIndicatorCount++;
                    });
                    
                    // Check for passive voice
                    const passiveWords = [" is ", " was ", " were ", " are ", " been ", " being "];
                    passiveWords.forEach(word => {
                        if (lowerSentence.includes(word)) aiIndicatorCount++;
                    });
                    
                    // Check for personal pronouns
                    const personalPronouns = [" i ", " we ", " my ", " our ", " me ", " us "];
                    personalPronouns.forEach(pronoun => {
                        if (lowerSentence.includes(pronoun)) humanIndicatorCount++;
                    });
                    
                    // Check for contractions
                    const contractions = ["don't", "can't", "won't", "it's", "i'm", "you're", "they're", "we're"];
                    contractions.forEach(contraction => {
                        if (lowerSentence.includes(contraction)) humanIndicatorCount++;
                    });
                    
                    // Determine if sentence is likely AI or human
                    let isAI = false;
                    let isHuman = false;
                    
                    if (aiIndicatorCount > humanIndicatorCount) {
                        isAI = true;
                    } else if (humanIndicatorCount > aiIndicatorCount) {
                        isHuman = true;
                    } else {
                        // Tiebreaker: use overall AI score
                        isAI = aiScore > adjustedThreshold;
                        isHuman = aiScore <= adjustedThreshold;
                    }
                    
                    // Apply highlighting
                    if (isAI) {
                        highlightedHTML += `<span class="ai-highlight">${sentence}</span>`;
                    } else if (isHuman) {
                        highlightedHTML += `<span class="human-highlight">${sentence}</span>`;
                    } else {
                        highlightedHTML += `<span class="neutral-text">${sentence}</span>`;
                    }
                    
                    // Add space after sentence (but not if next is punctuation)
                    if (i < sentences.length - 1 && !/^[.!?]+$/.test(sentences[i + 1])) {
                        highlightedHTML += ' ';
                    }
                }
                
                return highlightedHTML;
            }
            
            // Generate suggestions based on analysis
            function generateSuggestions(text, analysis) {
                const suggestions = [];
                
                // Always show the overall score interpretation
                if (analysis.aiScore > 70) {
                    suggestions.push({
                        title: "High AI Probability Detected",
                        description: "Your text shows strong AI indicators. Consider rewriting with more personal voice, anecdotes, and varied sentence structures."
                    });
                } else if (analysis.aiScore > 40) {
                    suggestions.push({
                        title: "Mixed AI/Human Characteristics",
                        description: "Your text has both AI and human elements. To make it more human, add personal insights and vary your vocabulary."
                    });
                } else {
                    suggestions.push({
                        title: "Primarily Human Characteristics",
                        description: "Your text reads as mostly human-written. To maintain authenticity, keep your unique voice and perspective."
                    });
                }
                
                // Specific suggestions based on analysis
                if (analysis.sentenceVariation < 40) {
                    suggestions.push({
                        title: "Vary Sentence Lengths",
                        description: `Your sentence variation score is ${analysis.sentenceVariation}%. Mix short, medium, and long sentences to create more natural rhythm.`
                    });
                }
                
                if (analysis.vocabDiversity < 50) {
                    suggestions.push({
                        title: "Increase Vocabulary Diversity",
                        description: `Your vocabulary diversity is ${analysis.vocabDiversity}%. Try using synonyms and avoiding repeated phrases.`
                    });
                }
                
                // Check for passive voice
                const lowerText = text.toLowerCase();
                const passiveWords = [" is ", " was ", " were ", " are ", " been ", " being "];
                let passiveCount = 0;
                passiveWords.forEach(word => {
                    const regex = new RegExp(word, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) passiveCount += matches.length;
                });
                
                if (passiveCount > 5) {
                    suggestions.push({
                        title: "Reduce Passive Voice",
                        description: `Found ${passiveCount} passive voice constructions. Use active voice for more direct, engaging writing.`
                    });
                }
                
                // Check for lack of personal pronouns
                const personalPronouns = [" i ", " we ", " my ", " our ", " me ", " us "];
                let pronounCount = 0;
                personalPronouns.forEach(pronoun => {
                    const regex = new RegExp(pronoun, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) pronounCount += matches.length;
                });
                
                if (pronounCount < 2 && text.length > 200) {
                    suggestions.push({
                        title: "Add Personal Perspective",
                        description: "Your text lacks personal pronouns. Consider adding 'I', 'we', or 'my' to make it more relatable."
                    });
                }
                
                // Check for overly formal language
                const formalTransitions = ["however", "therefore", "consequently", "thus", "hence", "nevertheless"];
                let formalTransitionCount = 0;
                formalTransitions.forEach(word => {
                    const regex = new RegExp(`\\b${word}\\b`, 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) formalTransitionCount += matches.length;
                });
                
                if (formalTransitionCount > 3) {
                    suggestions.push({
                        title: "Simplify Transition Words",
                        description: `Found ${formalTransitionCount} formal transitions. Try simpler alternatives like 'but', 'so', or 'and'.`
                    });
                }
                
                // Ensure we have enough suggestions
                if (suggestions.length < 3) {
                    suggestions.push({
                        title: "Read Aloud for Natural Flow",
                        description: "Reading your text aloud can help identify unnatural phrasing that might sound AI-generated."
                    });
                    
                    suggestions.push({
                        title: "Add Specific Examples",
                        description: "AI text often lacks specific, concrete examples. Include real-world instances to increase authenticity."
                    });
                }
                
                return suggestions.slice(0, 5); // Return max 5 suggestions
            }
            
            // Update the chart with results
            function updateChart(aiScore, humanScore) {
                // Destroy existing chart if it exists
                if (detectionChart) {
                    detectionChart.destroy();
                }
                
                // Create new chart
                detectionChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['AI-Generated', 'Human-Written'],
                        datasets: [{
                            data: [aiScore, humanScore],
                            backgroundColor: ['#fc00ff', '#00dbde'],
                            borderColor: ['rgba(255,255,255,0.2)', 'rgba(255,255,255,0.2)'],
                            borderWidth: 2,
                            hoverOffset: 15
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#f0f0f0',
                                    font: {
                                        size: 14
                                    },
                                    padding: 20
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            // Update the UI with results
            function updateUI(results, suggestions, text) {
                // Update percentages
                aiPercentage.textContent = `${results.aiScore}%`;
                humanPercentage.textContent = `${results.humanScore}%`;
                
                // Update chart
                updateChart(results.aiScore, results.humanScore);
                
                // Update confidence
                confidenceValue.textContent = `${results.confidence}%`;
                confidenceFill.style.width = `${results.confidence}%`;
                
                // Update metrics
                wordCount.textContent = results.wordCount;
                readabilityScore.textContent = results.readability;
                sentenceVariation.textContent = `${results.sentenceVariation}%`;
                vocabDiversity.textContent = `${results.vocabDiversity}%`;
                
                // Color code readability
                if (results.readability < 30) {
                    readabilityScore.className = "detail-value red-flag";
                } else if (results.readability < 60) {
                    readabilityScore.className = "detail-value yellow-flag";
                } else {
                    readabilityScore.className = "detail-value green-flag";
                }
                
                // Color code sentence variation
                if (results.sentenceVariation < 30) {
                    sentenceVariation.className = "detail-value red-flag";
                } else if (results.sentenceVariation < 60) {
                    sentenceVariation.className = "detail-value yellow-flag";
                } else {
                    sentenceVariation.className = "detail-value green-flag";
                }
                
                // Color code vocabulary diversity
                if (results.vocabDiversity < 40) {
                    vocabDiversity.className = "detail-value red-flag";
                } else if (results.vocabDiversity < 70) {
                    vocabDiversity.className = "detail-value yellow-flag";
                } else {
                    vocabDiversity.className = "detail-value green-flag";
                }
                
                // Update suggestions
                suggestionsList.innerHTML = '';
                suggestions.forEach(suggestion => {
                    const suggestionElement = document.createElement('div');
                    suggestionElement.className = 'suggestion-item';
                    
                    suggestionElement.innerHTML = `
                        <div class="suggestion-title">
                            <i class="fas fa-lightbulb"></i>
                            <span>${suggestion.title}</span>
                        </div>
                        <p>${suggestion.description}</p>
                    `;
                    
                    suggestionsList.appendChild(suggestionElement);
                });
                
                // Update highlighted text
                highlightedText.innerHTML = highlightText(text, results.aiScore);
            }
            
            // Analyze button click handler
            analyzeBtn.addEventListener('click', function() {
                const text = inputText.value.trim();
                
                if (text.length < 10) {
                    alert("Please enter at least 10 characters for analysis.");
                    return;
                }
                
                // Show loading state
                const originalText = analyzeBtn.innerHTML;
                analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
                analyzeBtn.disabled = true;
                
                // Update highlighted text with loading state
                highlightedText.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;"><i class="fas fa-spinner fa-spin fa-2x" style="margin-bottom: 15px; display: block;"></i><p>Analyzing text and highlighting AI vs human sections...</p></div>';
                
                // Simulate analysis delay
                setTimeout(() => {
                    const results = analyzeTextDeterministically(text);
                    const suggestions = generateSuggestions(text, results);
                    
                    updateUI(results, suggestions, text);
                    
                    // Reset button
                    analyzeBtn.innerHTML = originalText;
                    analyzeBtn.disabled = false;
                }, 800);
            });
            
            // Clear button click handler
            clearBtn.addEventListener('click', function() {
                inputText.value = '';
                
                // Reset UI
                aiPercentage.textContent = '0%';
                humanPercentage.textContent = '0%';
                confidenceValue.textContent = '0%';
                confidenceFill.style.width = '0%';
                wordCount.textContent = '0';
                readabilityScore.textContent = '0';
                sentenceVariation.textContent = '0%';
                vocabDiversity.textContent = '0%';
                
                // Reset chart
                if (detectionChart) {
                    detectionChart.destroy();
                    detectionChart = null;
                }
                
                // Initialize empty chart
                updateChart(0, 0);
                
                // Reset suggestions
                suggestionsList.innerHTML = `
                    <div class="suggestion-item">
                        <div class="suggestion-title">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Analyze text to get suggestions</span>
                        </div>
                        <p>Click "Analyze Text" to see specific recommendations for making your content sound more natural and human-like.</p>
                    </div>
                `;
                
                // Reset highlighted text
                highlightedText.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;"><i class="fas fa-highlighter fa-2x" style="margin-bottom: 15px; display: block;"></i><p>Your text will appear here with AI parts highlighted in purple and human parts in blue after analysis.</p></div>';
            });
            
            // Save button click handler
            saveBtn.addEventListener('click', function() {
                const text = inputText.value.trim();
                
                if (text.length < 10) {
                    alert("Please analyze some text first before saving.");
                    return;
                }
                
                // Create a summary of the analysis
                const aiPercent = aiPercentage.textContent;
                const humanPercent = humanPercentage.textContent;
                const confidence = confidenceValue.textContent;
                
                const summary = `AI Detector Analysis Summary:
                
Text Length: ${wordCount.textContent} words
AI Probability: ${aiPercent}
Human Probability: ${humanPercent}
Confidence: ${confidence}
Readability: ${readabilityScore.textContent}
Sentence Variation: ${sentenceVariation.textContent}
Vocabulary Diversity: ${vocabDiversity.textContent}

Analysis Date: ${new Date().toLocaleString()}
                `;
                
                // Create a blob and download link
                const blob = new Blob([summary], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ai-detector-analysis.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show confirmation
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                }, 2000);
            });
            
            // Sample text buttons
            sampleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sampleType = this.getAttribute('data-sample');
                    inputText.value = sampleTexts[sampleType];
                    
                    // Auto-analyze after loading sample
                    setTimeout(() => {
                        analyzeBtn.click();
                    }, 300);
                });
            });
            
            // Initialize with an empty chart
            updateChart(0, 0);
            
            // Auto-analyze the default text on page load
            setTimeout(() => {
                analyzeBtn.click();
            }, 800);
        });
    </script>
</body>
</html>
